{
  "paper_id": "XAD2IBY8",
  "title": "An experimental design for the development of adaptive treatment strategies",
  "abstract": "In adaptive treatment strategies, the treatment level and type is repeatedly adjusted according to ongoing individual response. Since past treatment may have delayed e ects, the development of these treatment strategies is challenging. This paper advocates the use of sequential multiple assignment randomized trials in the development of adaptive treatment strategies. Both a simple ad hoc method for ascertaining sample sizes and simple analysis methods are provided.",
  "year": 2004,
  "date": "2004-12-07",
  "journal": "Psychosomatic Medicine",
  "publication": "Psychosomatic Medicine",
  "authors": [
    {
      "forename": "S",
      "surname": "Murphy",
      "name": "S Murphy",
      "email": "samurphy@umich.edu"
    },
    {
      "affiliation": "Department of Statistics ; Institute for Social Research ; University of Michigan ; Ann Arbor ; MI ; U.S.A. \n\t\t\t\t\t\t\t\t Department of Statistics \n\t\t\t\t\t\t\t\t Institute for Social Research \n\t\t\t\t\t\t\t\t University of Michigan \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t Ann Arbor \n\t\t\t\t\t\t\t\t\t MI \n\t\t\t\t\t\t\t\t\t U.S.A"
    },
    {
      "affiliation": "Department of Statistics , Institute for Social Research , University of Michigan , Ann Arbor , MI , U.S.A. \n\t\t\t\t\t\t\t\t Department of Statistics \n\t\t\t\t\t\t\t\t Institute for Social Research \n\t\t\t\t\t\t\t\t University of Michigan \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t Ann Arbor \n\t\t\t\t\t\t\t\t\t MI \n\t\t\t\t\t\t\t\t\t U.S.A"
    }
  ],
  "doi": "10.1002/sim.2022",
  "keywords": [
    "therapeutic strategies",
    "treatment algorithms",
    "sequential multiple assignment randomized trial",
    "multi-stage decision problems",
    "dynamic treatment regimes"
  ],
  "sections": [
    {
      "title": "INTRODUCTION",
      "text": "Adaptive treatment strategies are emerging as a new paradigm for the treatment and long term management of chronic, relapsing disorders such as alcoholism, smoking cessation, cocaine abuse, depression and hypertension  [1] [2] [3] [4] [5] [6] [7] . In adaptive treatment strategies the treatment level and type is repeatedly adjusted according to the individual's need. The rationale is that the response is optimized by varying treatment type and dosage as a function of measures of timedependent information such as response to past treatment. An adaptive treatment strategy is characterized by a sequence of decision rules, one per treatment decision. Adaptive treatment strategies are frequently called dynamic treatment regimes  [8] [9] [10] [11] [12] [13] .\n\nCurrently scientists use a combination of clinical experience, trial and error, behavioural, psychosocial and biological theories, results from observational studies and randomized experimental studies conducted for other purposes, to formulate the decision rules composing adaptive treatment strategies. In this paper we propose the use of experimental trials for the development of the decision rules. Our long term goal is to optimize the adaptive treatment strategies, that is produce a treatment strategy that yields the best mean value of the outcome. We concentrate on a major challenge, that of delayed e ects, to designing randomized trials in this setting. We propose the use of sequential multiple assignment randomized (SMAR) trials for developing decision rules as these trials do not make a priori assumptions on the existence or form of the delayed e ects. In a SMAR trial, each individual may be randomized multiple times; the multiple randomizations occur sequentially through time.\n\nA number of SMAR trials have been or are being conducted. These include the CATIE trial for antipsychotic medications in patients with Alzheimer's  [14] , the CATIE trial for antipsychotic medications in patients with Schizophrenia, STAR*D for treatment of depression  [15, 16]  and phase II trials at MD Anderson for treating cancer  [17] . In most cases the goals of these trials are to develop adaptive treatment strategies (sequences of treatments for an individual) and are not con\u00ffrmatory. That is, the goal does not include con\u00ffrming that one adaptive treatment strategy is better than control or standard treatment. Con\u00ffrmatory trials comparing an optimized adaptive treatment strategy with the appropriate control or standard treatment would follow such studies.\n\nTo \u00ffx ideas we use the following simpli\u00ffed example throughout."
    },
    {
      "title": "Example",
      "text": "Consider an addiction management study for alcohol dependent subjects. In this simple example there are only two decisions, choosing the initial treatment and the secondary treatment. Following an intensive outpatient program, alcohol dependent subjects may be prescribed either an opiate antagonist (med with low level of counselling) or intensive cognitive behavioural therapy (cbt). Then in the next two months clinicians record heavy drinking, adherence, self-management skill and other intermediate outcomes. Individuals are classi\u00ffed as responders or non-responders based on their level of heavy drinking. Note that the terms responder/non-responder refer to the level of heavy drinking while the individual is on the initial treatment. If an individual is a non-responder to med then we must decide whether to either switch to cbt or assign an enhanced motivational program with a step up(em+cbt +med). If an individual is a non-responder to cbt then we must decide whether to switch to med or provide the step-up in treatment, em + cbt + med. Responders to the initial treatment should be assigned either to telephone monitoring (tm) or telephone counselling and monitoring (tmc). The goal in the decision making is to formulate an adaptive treatment strategy that results in the highest per cent of days abstinent over a one year period. We seek two decision rules that will maximize the mean per cent days abstinent over the de\u00ffned period. The \u00ffrst decision rule can use pretreatment information such as level of addiction to choose the initial treatment. The second decision rule can utilize intermediate outcomes such as adherence to initial treatment, present level of self-management skill and number of heavy drinking days while on initial treatment to choose the second treatment. ticular primary analysis; associated with this analysis is a simple approach for ascertaining the sample size. Lastly we provide an simulation based evaluation of our sample size formula and in the discussion section we discuss methods and areas that need further scienti\u00ffc development.\n\nNote that the term 'adaptive' as used here refers to a time-varying therapy for managing a chronic, relapsing illness rather than an experimental design. This should not be confused with 'adaptive' experimental designs such as designs in which treatment allocation probabilities for the present patient depend on the responses of past patients References  [18, 19]  nor should this be confused with two stage adaptive experimental designs in which design parameters of an experimental trial are altered mid-trial  [20, 21] ."
    },
    {
      "title": "ADAPTIVE TREATMENT STRATEGIES",
      "text": "Suppose we will need to make at most k decisions, a 1 ; a 2 ; : : : ; a k per individual. S 1 denotes pretreatment information whereas S j , j6k denotes the intermediate outcome (ongoing information) available after decision a j-1 and prior to decision a j . Thus the time order is S 1 ; a 1 ; S 2 ; a 2 ; : : : ; S k ; a k ; S k+1 . We use an overbar to denote past and present information (e.g. S j = {S 1 ; : : : S j }). The primary outcome is Y = u( S k+1 ; a k ) where u is a known summary function. In the addiction management study, Y is the mean per cent days abstinent so u counts the number of days abstinent and divides by study length in days. An adaptive treatment strategy is a sequence of decision rules, one per decision. Thus we denote an adaptive treatment strategy by the decision rules {d 1 ; d 2 ; : : : ; d k } where the decision rule d j takes the information available at time j ( S j = {S 1 ; : : : ; S j } and past treatment a j-1 = {a 1 ; : : : ; a j-1 }) and outputs a treatment type/level, a j . For example in the addiction management study, k = 2 and the possible treatments, values for a 1 , at the \u00ffrst decision time point are med and cbt. The information available for making the second decision includes pretreatment information denoted by S 1 , the \u00ffrst treatment, and the intermediate outcomes denoted by S 2 . A simple example of a decision rule, d 2 , is: if the individual responds to initial treatment assign telephone monitoring with counselling or if the individual does not respond to initial treatment assign em + med + cbt.\n\nAs discussed in the introduction, the goal is to develop an adaptive treatment strategy that leads to the highest mean of Y (as compared to other possible adaptive treatment strategies). If we knew the multivariate distribution of S k+1 for each array of treatments a k , then this goal would be easily achieved. In this case, the ascertainment of the optimal or best adaptive treatment strategy is an optimization problem treated at great length by many authors  [22] [23] [24] . Classical algorithms use dynamic programming which is based on a backwards induction argument. We denote the optimal adaptive treatment strategy by {d * 1 (s 1 ); d * 2 ( s 2 ; a 1 ); : : : ; d * k ( s k ; a k-1 )}. Below we review the formulae for the optimal adaptive treatment strategy when k = 2; the formula for general k is similar  [24] .\n\nThe optimal decision at time 2 maximizes\n\nis the conditional mean of Y given S 2 when the treatment decisions are set at a 2 . The optimal decision is given by\n\nIntuitively V 2 is the highest mean of Y achievable given that we are at time 2, have made the previous decision, a 1 and have recorded information s 2 . V 2 is called the optimal bene\u00fft-to-go at time 2. The optimal decision at time 1 is\n\nThat is we integrate the optimal bene\u00fft to go at time 2 over the conditional distribution of S 2 given S 1 for treatment a 1 and then maximize. The optimal bene\u00fft-to-go at time 1 is given by\n\nThe mean of Y when the optimal rules are used to assign treatment (set\n\n) is given by the expected optimal bene\u00fft-to-go at time 1:\n\nThe optimal adaptive treatment strategy is (d * 1 ; d * 2 ). Observe that to obtain the optimal decision at time 2, we use the previously obtained optimal decision at time 1.\n\nThe above formulae are imprecise because we did not indicate the set of possible treatments over which each max aj is formed. In general the set of treatments is not the same for each time point and in addition past S j 's may restrict the set of possible treatments. In the addiction management study, the possible treatments at time 1 are med and cbt. But at time 2 the possible treatments depend on response to initial treatment.\n\nIn this paper the multivariate distribution of S k+1 indexed by the treatments a k is unknown; thus we cannot directly use the arguments given above to develop an optimal adaptive treatment strategy. Our goal is to propose experimental trials that will yield data for the formulation of an optimal adaptive treatment strategy. First we discuss the issue of delayed e ects; this will motivate the design of the experimental trial."
    },
    {
      "title": "DELAYED EFFECTS",
      "text": "In this section, we discuss why we want to observe intermediate and long term outcomes following each possible pattern of treatments across time; this motivates our design proposal of randomizing each individual multiple times. For clarity, we temporarily ignore sample variability and focus on correctly estimating which initial and subsequent treatments are best. Thus we use expectations rather than sample averages below. Once we have justi\u00ffed why it is important to observe intermediate and long term outcomes following each possible pattern of treatments we consider sampling issues (see the following sections).\n\nFor simplicity consider k = 2. Recall that the optimal rule for assigning treatment at time two is the output of arg max a2 E a2 [Y | S 2 = s 2 ]. Certainly if this rule yields di erent secondary treatments depending on the initial treatment then in order to estimate the best secondary treatment we need to observe outcomes following each pattern of initial and secondary treatments. Also estimating the best initial treatment may require outcomes following each pattern of initial and secondary treatments. To see this consider the criterion function for ascertaining the best decision at time 1 (see  (2) ) and note that this criterion function depends on the optimal decision at time 2. To ascertain the \u00ffrst decision we must maximize\n\nds 2 (4) over a 1 (note f a1 (s 2 |s 1 ) is the conditional density of S 2 given S 1 indexed by a 1 ). Thus a 1 plays a role in the criterion function (4), both through the product of the density f a1 (s 2 |s 1 ) and the maximized conditional mean max a2 E a2 [Y | S 2 = s 2 ]. Thus if max a2 E a2 [Y | S 2 = s 2 ] depends on a 1 then in general to estimate the best initial treatment we need to observe intermediate and long term outcomes following each possible pattern of {a 1 ; a 2 }. Certainly a treatment a 1 that produces very good values of S 2 (e.g. optimizes the mean of the density f a1 (s 2 |s 1 )) may not be the best initial treatment in an adaptive treatment strategy. We have argued that if max a2 E a2 [Y | S 2 = s 2 ] depends on a 1 then in general to estimate the best initial treatment we need to observe intermediate and long term outcomes following each possible pattern of {a 1 ; a 2 }. One way in which the maximized conditional mean, max a2\n\n, may depend on a 1 is if the e ect of treatment at time 2 varies by the initial treatment (an interaction between initial and secondary treatments on the primary outcome, Y ). There are at least two ways in which the e ect of treatment at time 2 varies by the initial treatment. We discuss these two ways in the context of our simple addiction management study. First a particular initial treatment may set the stage for an enhanced e ect by a particular secondary treatment. For example, suppose counselling is more e ective than monitoring among responders to cbt; that is the individual learns to use counselling during cbt and thus is able to take advantage of the counselling o ered to responders. Individuals who received med during the initial treatment will not have learned to use counselling and thus among responders to med the addition of counselling to the monitoring does not improve abstinence (Y ) relative to monitoring alone. If an individual is a responder to cbt it is best to o er tmc as the secondary treatment, but if the individual is a responder to med it is best to o er the less expensive tm as the secondary treatment. In summary even if cbt and med result in the same proportion of responders, cbt may be the best initial treatment as part of the adaptive treatment strategy. This would be due to the enhanced e ect of tmc when preceded by cbt.\n\nA second way in which the e ect of secondary treatment varies by the initial treatment is a consequence of Berkson's fallacy  [25, p. 73] . Suppose that there is an unknown factor U that a ects one's ability to respond to treatment. Here we conceptualize this factor as level of structure in one's life; U = H if highly structured environment and U = L if chaotic environment. We can expect that U is positively related to the intermediate outcome of responder/non-responder status and also U is positively related to Y , per cent days abstinent. Suppose also that the initial treatments have di ering e ects on responder/non-responder status. Berkson's fallacy is the conditional correlation between U and initial treatment assignment given non-response to initial treatment. Intuitively a non-responder who received the better initial treatment is more likely to live in a chaotic environment."
    },
    {
      "title": "S. A. MURPHY",
      "text": "The following numerical example illustrates how Berkson's fallacy results in an interaction of secondary and initial treatments on outcome Y . Suppose the following relationship holds among non-responders:\n\nMean of Y among non-responders by secondary treatment and given structure of environment,\n\nRecall Y is per cent days abstinent and thus large values are good. Thus non-responders who live in a chaotic environment do not bene\u00fft from the step-up in treatment (possibly due to non-adherence), yet if a non-responder lives in highly structured environment, the step-up in treatment is more bene\u00ffcial than switching treatment. The conditional means in the table are the same regardless of the value of the initial treatment a 1 . This table re ects the in uence of the unobserved background variable U on Y . The level of structure in one's life U is also related to the intermediate outcome of responder/non-responder as follows:\n\nProbability of response by initial treatment and given structure of environment,\n\nLastly suppose that\n\n1 2 of addicted individuals live in a chaotic environment. Using the formula, E a1;a2 [Y |S 2 = NR] = u\u2208{H; L} E a1; a2 [Y |S 2 = NR; U = u]P a1 [S 2 = NR|U = u]P[U = u] u\u2208{H; L} P a1 [S 2 = NR|U = u]P[U = u] we obtain the table. Mean of Y among non-responders by secondary and initial treatments, E a1; a2 [Y |S 2 = NR] a 2 = switch a 2 = step-up a 1 = med 17.5 20 a 1 = cbt 15.8 13.3\n\nThus if an individual is a non-responder to med it is best to o er the step-up in treatment (to em + med + cbt) whereas if the individual is a non-responder to cbt it is best to o er a switch in treatment (to med). So we see that there is an interaction between initial and secondary treatments; this interaction is due to Berkson's fallacy (there is no interaction conditional on unobserved U ). Since many chronic disorders (in particular, substance abuse and mental illness) appear to have psychosocial, biological and genetic causes, one can expect that U is high dimensional and that Berkson's fallacy may occur; max a2 E a2 [Y | S 2 = s 2 ] may depend on a 1 . Thus in order to estimate the best initial treatment we should observe the primary outcome following each pattern of initial and secondary treatments (recall (4)).\n\nIn many settings prior randomized trials of initial treatments (followed by standard or no treatment or treatment as available in the community) may indicate that a particular treatment rule, say, d 1 (S 1 ) is best in terms of maximizing long term outcome (Y ). Unfortunately the best initial treatment when the secondary treatment is set to a standard treatment (say b 2 ) is not necessarily the best initial treatment in an adaptive treatment strategy. That is, d 1 (S 1 ) an estimator of arg max\n\nThus the resulting rule may not be optimal in the context of an adaptive treatment strategy (the resulting rule is optimal if the only available secondary treatment is the standard treatment).\n\nAn interesting open problem would be to document the kinds of assumptions that make it possible to estimate the best adaptive treatment strategy from multiple experiments, one per decision. In the \u00ffeld of medical decision making (see for example,  [24, 26, Chapter 5]  the applied example in Reference  [27] , Markovian assumptions along with the fact that earlier decisions are used only to reveal information (early decisions are diagnostic tests and only the last decision is a treatment) permit one to combine information across multiple experiments."
    },
    {
      "title": "SEQUENTIAL MULTIPLE ASSIGNMENT RANDOMIZED TRIALS",
      "text": "We propose that SMAR trials be used to develop adaptive treatment strategies. This type of trial has been proposed by Lavori and Dawson  [28, 13] . In a SMAR trial each individual is randomized multiple times; that is, at each decision time. Thus individuals following each of the possible treatment patterns are observed. The randomization probabilities may depend on past and present observations. Since the treatments are randomized we use A j instead of lower case a j as in previous sections. Thus the data for one individual in a SMAR trial is given by ( S k+1 ; A k ). Data from SMAR trials satis\u00ffes P[S j+1 6s j+1 | S j = s j ; A j = a j ] = P aj [S j+1 6s j+1 | S j = s j ] for each j; that is the conditional distributions required to form optimal adaptive treatment strategies (for example, the optimal decisions in (2) and (  1 )) are identi\u00ffed by the corresponding empirical distributions in the SMAR trial. See the appendix for a proof of this equality.\n\nAdaptive treatment strategies can be viewed as multi-component treatments with many components (e.g. which primary treatment, when to alter treatment, which treatment to provide S. A. MURPHY non-responders, form of monitoring or secondary treatment to provide responders to the primary treatment, what information to use to decide which treatment is best, etc.). Consider the addiction management study. It is natural to expect that pretreatment information such as the presence of co-occurring disorders such as mental illness and homelessness might discriminate between individuals for whom it is best to receive med as the initial treatment in the strategy versus individuals for whom it is best to receive cbt initially. Furthermore, oninitial-treatment information such as the level of adherence to initial treatment and evolving level of self management skill in addition to responder status may be useful in discriminating who should get which secondary treatment. Thus the development of an adaptive treatment strategy not only requires consideration of possible treatments but also consideration of what information should be used in the decision rules. Viewed in this light the development of an adaptive treatment strategy is indeed a high dimensional problem. We propose several design principles that have the goal of reducing the dimensionality and we propose randomization probabilities that equalize sample size among di erent adaptive treatment strategies.\n\nPrinciple I: When designing the trial restrict the class of treatment options at each decision point only by ethical, scienti\u00ffc or feasibility considerations. We conceptualize the S j 's as containing only information that is to be used to constrain treatment options due to ethical, scienti\u00ffc or feasibility considerations. In practice S j would be a known function of a larger amount of data, X j that is collected prior to the jth decision time. The X j 's contain auxiliary information that may be useful in optimizing treatment but except via the information in S j will not constrain treatment options in the trial. Thus the randomization probability for each A j will depend on at most ( S j ; A j-1 ). We expect that in most practical settings S j will be of low dimension (e.g. binary or trinary). Note however that the formulae given in the previous sections hold with X in place of S and with Y = u( X k+1 ; A k ). An additional rationale for allowing the randomization probabilities to only depend on the S's (the ethical, scienti\u00ffc or feasibility constraints) is to prevent undue restriction of the class of adaptive treatment strategies. When the experimental design for a SMAR trial speci\u00ffes that the class of alternative treatments is to be restricted by past history, we are in e ect restricting the class of adaptive treatment strategies to be considered. This point surfaces in the next section in the form of assumption  (8) .\n\nAs an example of this principle consider the addiction management study. Here the X 's might include measures of an individual's experiences with the past treatments such as acceptability, adherence, burden, level of side e ects, motivation level and also might include ongoing developments such as the level of craving, stress levels and other potential indicators of an impending relapse to heavy drinking. In general, information that is predictive of how one might respond di erently to di erent kinds of treatments should be included in the X 's. Indeed it would be tempting to specify di erent secondary treatment options for initial-treatment-non-adhering-non-responders and initial-treatment-adhering-nonresponders. However this would mean that we would only consider strategies that treat these two groups of non-responders di erently. Unless this is known to be necessary, this constitutes an unnecessary restriction on the class of possible adaptive treatment strategies. Of course observing degree of adherence to initial treatment makes possible secondary analyses in which we test if adherence to initial treatment should be used to discriminate between secondary treatments.\n\nPrinciple II: View this trial as one trial in a series of developmental, randomized trials see  [29, Chapters 9, 15]  prior to a con\u00ffrmatory trial. This viewpoint reduces the dimensionality problems since we do not expect this one trial to produce an optimized adaptive treatment strategy. Note this viewpoint is consistent with the present ongoing SMAR trials discussed in the introduction(CATIE and STAR*D); these trials are not designed to con\u00ffrm a best adaptive treatment strategy. Each developmental trial would build on the results of prior trials. A full development of Box's approach in this setting is an open problem (see the discussion for simple examples of how such developmental trials might proceed). A con\u00ffrmatory randomized control trial of the developed adaptive treatment strategy versus the appropriate comparison (control or standard care) would follow.\n\nRandomization probabilities proposal: We provide randomization probabilities that create equal sample sizes across strategies. In other words we set the randomization probabilities so that the proportion of subjects whose treatment assignments are consistent with an adaptive treatment strategy is constant across adaptive treatment strategies; equivalently, P[ A k = d k ] will not depend on d k . Achieving this is more complicated than at \u00ffrst appears as the treatments for any subject are consistent with more than one adaptive treatment strategy. One can view this approach as being consistent with the working assumption that the variance of Y under di erent strategies is constant. (Recall the classical result that in a large sample comparison of two means, assuming equal variances, equal sample sizes in the two groups maximizes power).\n\nActually in setting the randomization probabilities we go one step further. We equalize sample sizes at each decision j among the possible treatment strategies beginning at that decision. That is, if we consider the adaptive treatment strategies beginning at decision j with 'pretreatment' information equal to ( S j ; A j-1 ), then the sample size for each of these strategies should be the same; for each j, P[ A k = d k | S j ; A j-1 = d j-1 ] will not depend on (d j ; : : : ; d k ). This approach of balancing sample sizes across di erent strategies is ad hoc; the best choice of randomization probabilities is an open question.\n\nDenote the number of treatment options for the history, ( s j ; a j-1 ) by n j ( s j ; a j-1 ). Note the possible dependence both on prior treatment and on the S's. First we provide simple formula for the randomization probabilities when each n j ( s j ; a j-1 ) = n j ( a j-1 ), that is the number of treatment options does not depend on the S's and for k = 2. See the appendix for arbitrary k. In this case formulae for the randomization probabilities do not depend on the S's and are as follows: Set N 2 (a 1 ) = n 2 (a 1 ). Denote the randomization probability of assigning treatment a 2 at time 2 for an individual with past history, ( S 2 ; A 1 ) = ( s 2 ; a 1 ) by p 2 (a 2 | s 2 ; a 1 ) and similarly for initial treatment. Then\n\nNote the time 2 randomization probabilities are uniform. Next\n\nand\n\nSee the appendix for a proof that these randomization probabilities result in strategies with equal expected sample sizes."
    },
    {
      "title": "S. A. MURPHY",
      "text": "The above formulae simplify further when the number of treatment possibilities do not depend on past treatment; in this case N j = k '=j n ' and each p j (a j ) = 1=n j . The randomization probabilities are uniform over the options at each time. Consider the addiction management study; there are two treatment options for each responder class at decision 2 and two treatment options at time 1, thus all randomization probabilities are equal to 0.5. Suppose instead that the only secondary treatments following medication (med) are telephone monitoring for responders, and a step-up for non-responders. Secondary treatments remain the same for individuals initially assigned cognitive behavioural therapy (cbt). In this case med responders are assigned telephone monitoring with probability one whereas cbt responders are assigned one of the two options with probability 0.5. Similarly for med non-responders and cbt non-responders. Next, N 2 (med) = 1 and N 2 (cbt) = 2, so N 1 = 3 and we assign cbt therapy with probability 2=3 (N 2 (cbt)=N 1 ) and medication with probability 1=3 (N 2 (med)=N 1 ).\n\nWhen the number of treatment options depend on the S's, randomization probabilities that equalize sample size across strategies become more complicated and more importantly depend on the distribution of each S j given ( S j-1 ; A j-1 ). We provide the general formulae in the appendix along with a proof. When k = 2, these formulae yield, p 2 (a 2 | S 2 ; A 1 ) = n 2 ( S 2 ; A 1 ) -1 and\n\nTo use these formulae, we need to make a working assumption concerning the probability distribution of S 2 given (S 1 ; A 1 ). In the simulations we make the extreme working assumption that the distribution of each S j given ( S j-1 ; A j-1 ) assigns mass 1 to the value of S j with the largest number of subsequent treatment strategies. For k = 2 this implies that p 2 (a 2 | S 2 ; A 1 ) = n 2 ( S 2 ; A 1 ) -1 and p 1 (a 1 |S 1 ) = max s2 n 2 (s 2 ; S 1 ; a 1 )\n\nb=1 max s2 n 2 (s 2 ; S 1 ; b) See the appendix for the formula for general k. In both of the CATIE studies, there are multiple treatment possibilities for non-responders but only one possible treatment for responders. Consider the addiction management study and suppose responders are provided one particular maintenance treatment and non-responders are randomized between the two treatment alternatives. If we assume that the responder rates for cbt and med are the same, then the randomization probabilities for non-responders are 1/2 and the initial randomization probabilities are also 1/2."
    },
    {
      "title": "TEST STATISTIC AND SAMPLE SIZE FORMULA",
      "text": "In order to power the SMAR trial a primary analysis must be speci\u00ffed. For example in the addiction management study, a natural and simple primary analysis would be to test if cbt di ers from med in terms of the intermediate outcome, responder status. But we saw in Section 3 that in the absence of additional scienti\u00ffc assumptions, the results of such an analysis are not useful in ascertaining the initial treatment in an optimal adaptive treatment strategy. Of course an advantage of this primary analysis is that it is of low dimension! We advocate that the primary analysis test if two adaptive treatment strategies each beginning with a di erent initial treatment yield di erent mean outcomes. In this primary analysis we lower the dimension by considering only very simple adaptive treatment strategies.\n\nPrinciple III: The primary analysis should consider adaptive treatment strategies that depend only on S's (the ethical, scienti\u00ffc or feasibility constraints). Thus, for example, the primary analysis for the addiction management study would not consider rules depending on adherence to initial treatment. Note however that secondary analyses may investigate decision rules depending on the larger data including the X 's.\n\nPower proposal: Power the developmental SMAR trial to discriminate between two adaptive treatment strategies, each depending only on the S's and each beginning with a di erent initial treatment. That is, compare pairs of adaptive treatment strategies in which the initial treatment varies by member of the pair. The rationale is that we need to decide which of the possible initial treatments are worthy of further investigation. The second and further randomizations will create comparable groups receiving di erent subsequent treatments, so even though we have not powered the study for discriminating between subsequent treatments, the randomization will permit an valid causal comparison between subsequent treatments. Subsequent developmental trials would then consider only the initial treatments that performed well in this trial; a simple, ideal result would be that a particular initial treatment A produces a much better adaptive treatment strategy (in terms of mean Y ) than alternative initial treatments, then further experimental trials would use treatment A and be powered to contrast adaptive treatment strategies with di erent secondary treatments.\n\nNote that one could power the trial so as to compare initial treatments, ignoring subsequent treatments. However this comparison will not generally assist us in formulating an adaptive treatment strategy because the mean of Y ignoring subsequent treatments will depend on the randomization probabilities. That is, the estimand will change depending on how one randomizes to subsequent treatments. Algebraically the mean response to the initial treatment a 1 ignoring subsequent treatment is given by (\n\n. The argument of the maximum of this quantity need not be the same estimand as  (2) .\n\nThe fact that SMAR trials are relatively new, with little practical experience by scientists, motivates us to consider sample size formulae in a simple setting. Thus in the following we focus attention on the setting in which there are a few major decisions (hence randomizations, say k = 2-4 randomizations per individual). Interpreting S 1 as containing only strong scienti\u00ffc, ethical or feasibility constraints on the class of initial treatments, there will be no S 1 if there is no need to place restrictions on the class of initial treatments. So the formulae below have no S 1 with the understanding that if restrictions on the class of initial treatments are necessary then we consider the subpopulations de\u00ffned by values of S 1 separately. A consequence of this is that the initial decision rule, d 1 , is simply a constant function specifying the same initial treatment for all within a subpopulation. Note this does not preclude consideration of d 1 a function of X 1 in secondary analyses.\n\nThe test statistic is based on the following estimator of the mean of Y under treatment strategy d k (denote by d k ). De\u00ffne\n\nwhere the indicator, I {B} is 1 if the event B occurs and 0 otherwise. Solve\n\nfor d k and call the solution \u02c6 d k . \u02c6 d k is our estimator of d k . In this equation, P n f(X ) is de\u00ffned as the average over the sample, 1=n n i=1 f(X i ). In this case\n\nSee Murphy et al.  [12]  for technical details. The estimating formula can be generalized to be doubly robust  [30] ; see the appendix for details. A crucial assumption underlying the consistency of this estimator is that\n\nwhere subscript, d k on the probability symbol indicates that this probability is calculated under the distribution of S k+1 when all treatments are assigned according to the strategy d k . That is we assume that at any decision time, and for any given history, the treatment speci\u00ffed by the adaptive strategy has a positive probability of being assigned. Since we will be comparing strategies, intuitively this assumption is that all feasible treatments have a non-zero probability of being assigned in the study. Given data from a SMAR trial, we can perform two-way comparisons of adaptive treatment strategies with di erent initial treatments, say d k and d k , by approximating the distribution of the di erence in estimators of mean response by a normal distribution. Since the primary purpose of the trial is to develop adaptive treatment strategies (as compared to attempting to con\u00ffrm the superiority of one strategy over the others), we are more concerned about missing signi\u00ffcant di erences between means rather than accidently concluding that two means are equal; thus we have not provided an adjustment for multiple comparisons. A consistent estimator of the variance of\n\n. Since one individual's treatment assignments cannot be consistent with multiple adaptive treatment strategies each beginning with di erent initial treatments, there is no cross product in the above formula for the variance estimator. The statistic\n\nhas, in large samples, a standard normal distribution under the null hypothesis that\n\n. See Murphy et al.  [12]  for a list of technical assumptions. The primary assumption is  (8) .\n\nSample size formula: To derive a sample size formula, we re-express the variance of \u221a n \u02c6 d k in terms of the distribution of S k+1 when all treatments are assigned according to d k as\n\nThe subscript, d k on the expectation symbol is meant to act as a reminder that this expectation is calculated under the distribution of S k+1 when all treatments are assigned according to d k . This formula for the variance is proved in the appendix. We provide sample size formula utilizing simple upper bounds on the variance  (10) . We consider two cases. First suppose the randomization probabilities are uniform on the possible treatment alternatives; it is immediate that an upper bound on the asymptotic variance of\n\nj=1 n j ( s j ; a j-1 ) 2 where 2 is the variance in response between individuals following the same adaptive treatment strategy\n\nAlternately, suppose we use randomization probabilities that produce equal sample sizes across the strategies as in (  5 ) and  (6) . If the number of treatment options depend at most on the past treatment (n j ( s j ; a j-1 ) depends at most on a j-1 for each j), then (  10 ) is equal to N 1 2 . This equality is derived in the appendix. Indeed if the number of treatment options does not depend on either s j or on a j-1 for each j then (  5 ) and (  6 ) are uniform randomization probabilities and N 1 = k j=1 n j . If number of treatment options depends on the S's, we make the extreme working assumption that the distribution of each S j given ( S j-1 ; A j-1 ) assigns mass 1 to the value of S j with the largest number of subsequent treatment strategies (j6k). In this case, N 1 2 is again an upper bound on  (10)  where\n\nSee the appendix for a proof.\n\nRecall that we set the sample size so that we can compare two adaptive treatment strategies each beginning with a di erent initial treatment. Let z =2 be the standard normal (1 -=2) percentile. Then the total sample size should be\n\nwhere \u00d1 is the appropriate upper bound from the previous paragraph, is the type I error of the two-sided test, and 1 -\u00ff is the power of the test to detect a di erence in the mean response of . Since these trials are meant to be developmental, might be set at a value larger than 0.05 and \u00ff might be small (say 0.05, 0.1)."
    },
    {
      "title": "SECONDARY ANALYSES",
      "text": "The multiple randomizations permit a variety of experimental secondary analyses. All of these analyses use randomization to justify causal inferences. For example, since the last decision optimizes a conditional mean  (1)  we can use regression analyses to test for di erences between S. A. MURPHY the \u00ffnal treatments. However note that only the last decision maximizes a conditional mean of Y (compare (1) with (  2 )) so use of a simple regression is limited to the last decision. See both Murphy  [31]  and Robins  [32]  for comments about other regression methods. Alternately we can compare two strategies with the same initial treatment using the statistic:\n\nAn asymptotic justi\u00ffcation for this statistic can be found in Murphy et al.  [12] . However if X is of moderate or high dimensions, then this type of statistic will not be useful for consideration of adaptive treatment strategies depending on the X 's (each d j is a function from ( X j ; a j-1 ) to a class of treatments) because very few or no individuals in the data will have treatment patterns consistent with any given treatment strategy based on the X 's. In this case one could estimate each conditional distribution, P[S j+1 6s j+1 | X j = x j ; A j = a j ] and then use Robin's 'G-computation formula' to estimate the mean response to a given strategy. This method has not yet received much attention.\n\nOther secondary analyses might estimate optimal decision rules; that is rules, d k , leading to the highest mean response (assume large values of Y are preferred). Such rules might very well be a function of the larger data, the X j 's. These methods use the sequential multiple assignment randomization to eliminate bias; see Murphy  [31]  and Robins  [32]  for methods that can be used to estimate such rules."
    },
    {
      "title": "SIMULATION RESULTS",
      "text": "The purpose of the simulations is to evaluate the utility of the sample size formula and corresponding test statistic. We consider settings in which there are two decisions (k = 2). There are three scenarios. Each has no S 1 , two initial treatments and a binary S 2 . In Scenario I, there are two secondary treatments for each of the values of S 2 . In Scenario II, there are two possible secondary treatments for each of the values of S 2 as long as the initial treatment is treatment 1. If the initial treatment is treatment 2, then there is only one possible secondary treatment for each value of S 2 . In Scenario III, there are two secondary treatments if the value of S 2 = 0 and only one possible secondary treatment if the value of S 2 = 1. To recap, in scenario I, the number of secondary treatments, n 2 does not depend on s 2 ; a 1 ; in Scenario II, n 2 depends on a 1 but not on s 2 and in Scenario III, n 2 depends on s 2 .\n\nIn the simulations, S 2 is binary with the probability of a 1 equal to f 1 or f 2 depending on whether the initial treatment, A 1 = 1 or 2. The possible secondary treatments are t s2;a1;1 or t s2;a1;2 following treatment a 1 and outcome S 2 = s 2 . We generated the response Y using Murphy's  [31]  generative model for adaptive treatment strategies. This model is described in the appendix. In all of the scenarios, the optimal strategy, d * 2 , is to assign treatment 1 initially then if S 2 = 0 assign the secondary treatment t 0; 1; 1 and if S 2 = 1 assign the secondary treatment t 1; 1; 1 . In each of the three scenarios, we simulated the data so that the di erence between the mean response to the optimal strategy (E d * 2 Y ) and the mean response to a strategy with initial treatment 2 (say E d2 Y ) is proportional to a common standard deviation, Var d * 2 Y = Var d2 Y . This proportionality constant or signal-to-noise ratio is = . For each scenario we simulated\n\nTable I. Scenario I. = (Sample size) P[S2 = 1|A1 = 1] P[S2 = 1|A1 = 2] Type 1 error Power 0.25(1097) 0.5 0.5 0.093 0.900 0.25(1097) 0.3 0.7 0.109 0.902 0.5(275) 0.5 0.5 0.097 0.901 0.5(275) 0.3 0.7 0.093 0.902 0.75(122) 0.5 0.5 0.117 0.891 0.75(122) 0.3 0.7 0.109 0.905 Table II. Scenario II. = (sample size) P[S2 = 1|A1 = 1] P[S2 = 1|A1 = 2] Type 1 Error Power 0.25(823) 0.5 0.5 0.107 0.860 0.25(823) 0.3 0.7 0.115 0.905 0.5(206) 0.5 0.5 0.113 0.900 0.5(206) 0.3 0.7 0.122 0.895 0.75(92) 0.5 0.5 0.120 0.882 0.75(92) 0.3 0.7 0.127 0.905\n\ndata for a variety of signal-to-noise ratios and values of f 1 , f 2 . We also ensured that there were at least one pair of adaptive treatment strategies with di erent initial treatments but with the same mean response. In this way we are able to check that the proposed procedure has the correct type one error rate (Table  I ). In all cases the estimator is  (7) ; the test statistic is given by  (9) . We set = 0:1 and \u00ff = 0:1 for the two-sided tests. Each simulation is of size 1000 data sets.\n\nConsider \u00ffrst Scenario I. We use randomization probabilities that balance the sample size among strategies; in this case these randomization probabilities are uniform, (0.5), because there are always two treatment options at each decision. Given a signal-to-noise ratio, we set the total sample size equal to the smallest integer greater or equal to\n\nClearly in this simple scenario the sample size formula and associated statistic perform well (Note that the binomial standard deviation for 1000 trials with p = 0:1 is approximately 0.01.) Recall for any data set, we can estimate the mean outcome to multiple adaptive treatment strategies with di ering initial treatments. The entries under the column labelled 'type 1 error' are due to comparisons of adaptive treatment strategies with di erent initial treatments but the same mean ( = 0), whereas the entries under the column labelled 'Power' are due to comparisons of adaptive treatment strategies with di erent initial treatments but means di er by = . In Scenario II we also use randomization probabilities that balance the sample size among strategies (Table  II ). Recall that there are two possible secondary treatments for each of the values of S 2 as long as the initial treatment is treatment 1. If the initial treatment is treatment 2, then there is only one possible secondary treatment for each value of S 2 . So the p 2 (a 2 |s 2 ; 1) = 0:5 for a 2 = t s2; 1; 1 or t s2; 1; 2 whereas p 2 (t s2; 2; 1 |s 2 ; 2) = 1. The randomization\n\nTable III. Scenario III. = (Sample size) P[S2 = 1|A1 = 1] P[S2 = 1|A1 = 2] Type 1 error Power 0.25(1097) 0.5 0.5 0.088 0.965 0.25(1097) 0.3 0.7 0.095 0.968 0.5(275) 0.5 0.5 0.095 0.964 0.5(275) 0.3 0.7 0.101 0.953 0.5(275) 0.2 0.2 0.115 0.909 0.75(122) 0.5 0.5 0.105 0.958 0.75(122) 0.3 0.7 0.108 0.954\n\nprobability at time 1 is p 1 (1) = 2=3. Given a signal-to-noise ratio, we set the total sample size equal to the smallest integer greater or equal to\n\nAs in scenario I, the sample size formula and associated statistic perform well (Note that the binomial standard deviation for 1000 trials with p = 0:1 is approximately 0.01.)\n\nRecall that in Scenario III, the number of treatment options at decision 2 depends on S 2 ; there are two secondary treatments if the value of S 2 = 0 and only one possible secondary treatment if the value of S 2 = 1. If we make the extreme working assumption that P[S 2 = 0|A 1 ] = 1, then the p 2 (a 2 |0; a 1 ) = 0:5 for a 2 = t 0; a1; 1 or t 0; a1; 2 whereas p 2 (t 1; a1; 1 |1; a 1 ) = 1. The randomization probability at time 1 is p 1 (1) = 2=4. Given a signal-to-noise ratio, we set the total sample size equal to the smallest integer greater or equal to\n\nAs expected, the sample size formula is (see Table  III ) conservative since not all individuals will respond with S 2 = 0 and thus be eligible for 2 rather than 1 secondary treatments.\n\nHowever note the additional \u00fffth row in which the probability of an individual responding with S 2 = 1 is 0.2. In this setting most of the individuals will be eligible for two secondary treatments rather than one and the working assumption that P[S 2 = 0|A 1 ] = 1 more closely approximates reality. In this case the sample size formula is accurate (0.909 is close to 0.9)."
    },
    {
      "title": "DISCUSSION",
      "text": "As stated above we view the SMAR trial as one trial in a series of developmental, randomized trials  [29, Chapters 9, 15]  prior to a con\u00ffrmatory trial. The generalization of Box's approach is an open problem. However to provide a indication of how such a sequence of trials might proceed consider the development of an adaptive treatment strategy for managing alcohol addiction. Suppose the treatment options are as in our example. To set the sample size, we begin with = \u00ff = 0:1 and a given e ect size (i.e. signal-to-noise ratio, = ). Then we use the formula in Section 5 with \u00d1 = 4 to calculate the sample size. After conducting the trial we \u00ffnd that a strategy beginning with med produces a higher per cent abstinent days than the strategies beginning with cbt. In secondary analyses we use regression to discover an unanticipated result that non-adhering-non-responders to the initial treatment do better when assigned the step up in treatment (em + cbt + med) whereas adhering-non-responders to the initial treatment do better when switched to cbt. In secondary analyses, using the methods of Murphy  [31]  or Robins  [32]  we do not \u00ffnd any pretreatment covariates that would produce subpopulations responding best (in terms of Y ) to adaptive treatment strategies beginning with cbt. Now we are ready for a second randomized trial. This trial would seek to replicate the unexpected results of the secondary analysis and further develop possible secondary treatments; this trial would involve only one randomization per individual as follows. We power the trial using the responder proportions from the prior trial so as to ensure su cient non-responders and responders. All individuals would be initially assigned med; responders would then be randomly assigned either to tm or tmc; non-responders might be assigned to one of cbt, em + med, or em + cbt + med. Thus in addition to attempting to replicate the results associated with adherence level, we also provide the opportunity to check if the improved Y of nonresponders is due to the addition of em or to the combination of em + cbt. Note that analyses for this second trial are standard regression analyses. Suppose that we see no di erence in the mean of Y for individuals receiving tm or tmc; since counselling is expensive we then decide to use tm as our secondary treatment for responders to med. Furthermore suppose that in the regression analysis of the non-responders to med the adherence level does not appear to make a di erence in mean Y and em + med + cbt continues to yield better mean Y than other secondary treatments. Now we are ready to proceed to a randomized-controlled con\u00ffrmatory trial. This would be a two group trial, the \u00ffrst group assigned to the strategy: med if responder then tm, if non-responder then em + med + cbt, and the second group assigned to treatment as usual.\n\nHere is an alternate possible sequence of trials. Suppose as before a strategy beginning with med produces a higher per cent abstinent days than the strategies beginning with cbt. However using the methods of Murphy  [31]  or Robins  [32] , secondary analyses of the data from the SMAR trial lead to the unexpected \u00ffnding that if an individual has a low pretreatment addiction level then adaptive treatment strategies beginning with cbt produce (scienti\u00ffcally) signi\u00ffcant higher per cent days abstinent than treatment strategies beginning with med. In this case a second SMAR trial with the same design would be run in an e ort to replicate this result. If this result replicates then separate trials would need to be conducted for the individuals with di erent pretreatment levels of addiction.\n\nEven the simplistic scenarios presented above illustrate how the development of adaptive treatment strategies presents a di cult challenge to experimental design due to the fact that these treatment strategies are high dimensional multi-component strategies evolving through time. Ideally the formulation of a powerful adaptive treatment strategy involves many decisions such as, when to start treatment, which treatment to start, when to step up treatment, which step-up treatment is best, when to step down treatment to maintenance=monitoring, which maintenance=monitoring treatment is best and what information to use to make each of the above decisions. This high dimensional problem appears insurmountable, but is crucially important as adaptive treatment strategies provide a paradigm whereby empirical evidence and statistical methods can improve clinical practice in which most treatment is adaptive, particularly in the management of chronic, relapsing disorders.\n\nWe envision that Box's approach  [29]  of multiple experimental trials (that take advantage of working assumptions based on clinical experience, scienti\u00ffc theories and past studies) will provide a paradigm for reducing the dimensionality in a principled fashion. How best to formulate the paradigm in this setting remains an open problem. However before Box's approach can be utilized, we must understand the array of potential working assumptions, including working assumptions concerning delayed e ects. This is an open area of research. The work presented here makes steps in this direction however it ignores an important issue that must be considered in order to fully assess the importance of delayed e ects. This is the issue of how to provide a principled method for trading o immediate outcomes against longer term outcomes. The rich area of reinforcement learning may o er some guidance  [23] .\n\nAn alternate to Box's approach is the adaptive experimental design as developed by Berry and colleagues  [33] [34] [35] [36] 18] . Here the word 'adaptive' refers to the experimental design rather than the treatment strategy as in this paper. That is, adaptive refers to the practice of using outcomes from prior individuals to specify the probability of assigning a given treatment to the present individual. Thall et al.  [36]  considers a combination of two stage experimental design (drop poorly performing strategies halfway through trial) with a SMAR trial for developing strategies in the treatment of acute myelogenous leukemia. This combination along with the Bayesian analysis represents an attractive alternative to our approach. It is unclear how the adaptive experimental design would deal with the high dimensionality present in the development of adaptive treatment strategies.\n\nOther open problems include the development and evaluation of sample size formulae in settings in which the number of treatment alternatives depends on the intermediate outcomes (S's) and one can make good working assumptions concerning the conditional distributions of the intermediate outcomes. In this paper we made the extreme working assumption that with probability one, S takes the value leading to the largest number of strategies. Clearly in many settings this assumption will lead to excessively large sample sizes. Another open problem is the best choice of randomization probabilities. We chose to set these randomization probabilities so that the sample size is balanced at each decision among subsequent strategies. It is unclear when, if ever, this is optimal. Indeed since the variance of the estimator of the mean response depends on the randomization probabilities it may be that in some settings using randomization probabilities depending on the larger X will reduce variance."
    },
    {
      "title": "APPENDIX",
      "text": "Sequential multiple assignment randomized (SMAR) trial: In order to prove that SMAR trial produces data that permits the development of optimal adaptive treatment strategies, we must prove that\n\nholds for all values of s j+1 , a j and for each j. Note that data from a SMAR trial provides information about the conditional probabilities on the left hand side; whereas the optimal adaptive treatment strategy is de\u00ffned in terms of probabilities on the right hand side. The di erence between these two probabilities is subtle. The former probability refers to a multivariate distribution that permits variation in treatments; possibly because treatments are chosen by individuals or are chosen for them or treatments are randomized. P[S j+1 6s j+1 | S j = s j ; A j = a j ] is the distribution of S j+1 among the subpopulation of individuals with values ( S j = s j ; A j = a j ). The latter probability refers to a multivariate distribution corresponding to all individuals having the same treatments a k . There is no variation in treatment in this multivariate distribution; all have treatments a k . According to this multivariate distribution P aj [S j+1 6s j+1 | S j = s j ] is the distribution of S j+1 among subpopulation of individuals with values ( S j = s j ). Note the di ering multivariate distributions and di ering de\u00ffnitions of the subpopulations. In general these two probabilities need not be equal; however they are equal under sequential multiple assignment randomization. To prove this equality we use the potential outcomes model  [8, [37] [38] [39] .\n\nInstead of considering a di erent distribution of the vector S j for each possible value of the treatments, a j-1 , we consider a di erent vector of random variables corresponding to each value of the treatment; these di erent random variables are the potential outcomes. Thus corresponding to each \u00ffxed value of the treatment vector, a j-1 we conceptualize a potential outcome denoted by S j ( a j-1 ) where S j ( a j-1 ) is the response at the end of the jth interval that a subject would have if he/she were assigned the treatments, a j-1 . For each j = 1; : : : ; k, the multivariate distribution of (S 1 ; S 2 (a 1 ); : : : ; S j ( a j-1 ) is the section 2 distribution of S j for the treatment vector a j , e.g. for a measurable set B, P aj-1 [S j \u2208 B| S j-1 = s j-1 ] is the conditional probability that the potential outcome, S j ( a j-1 ) \u2208 B given the potential outcomes, (S 1 ; S 2 (a 1 ); : : :\n\nLet A k be the collection of all possible k-vectors of treatments decisions. The set of all potential outcomes is {(S 1 ; S 2 (a 1 ); S 3 ( a 2 ); : : : ; S k+1 ( a k+1 )) : a k varying in A k } (S 1 does not vary by treatments but is included for completeness). We can rewrite Section 2 formulae for the optimal rules in terms of potential outcomes. For simplicity let k = 2. De\u00ffne Y ( a 2 ) as u(S 1 ; S 2 (a 1 ); S 3 ( a 2 ); a 2 ). Then the optimal decision rules are given by\n\nand\n\nAnd the optimal mean response is given by,\n\nWe use the potential outcomes to connect the formulae in Section 2 to the distribution for the observable data ( S k+1 ; A k ) from a SMAR trial. First we make the consistency assumption  [11]  that S k+1 from the observable data is the same as the potential outcome S k+1 ( a k ) evaluated at a k = A k , and so on, including S 2 = S 2 (A 1 ). Robins' consistency assumption is the assumption that an individual's response to treatment (the S's) in the study is a ected only by his or her treatment not by the treatment of others and that we have represented the treatment adequately by the a j 's (i.e. if there are 5 values of a j there are only 5 treatments). Because the treatments are randomized with randomization probabilities depending only on past and present information, we have that for each j = 1; : : : ; k, A j is independent of {(S 1 ; S 2 (a 1 ); S 3 ( a 2 ); : : : ; S k+1 ( a k+1 )) : a k varying in A k } given ( S j ; A j-1 ). Thus P[S j+1 6s j+1 | S j = s j ; A j = a j ] = P[S j+1 ( a j )6s j+1 | S j = s j ; A j = a j ] (consistency assumption) = P[S j+1 ( a j )6s j+1 | S j = s j ; A j-1 = a j-1 ] (randomization) S. A. MURPHY = P[S j+1 ( a j )6s j+1 | S j-1 = s j-1 ; S j ( a j-1 ) = s j ; A j-1 = a j-1 ] (consistency assumption) = P[S j+1 ( a j )6s j+1 | S j-1 = s j-1 ; S j ( a j-1 ) = s j ; A j-2 = a j-2 ] (use randomization and consistency repeatedly : : :)\n\n(by de\u00ffnition) So the consistency assumption in addition to the proof above allow us to connect the distribution of the data, denoted by P or E with no subscript to Section 2 multivariate distributions of S k+1 indexed by a K , denoted by P a k or E a k . Now we see that the formulae for optimal decisions in Section 2 can be written as functions of conditional distributions for the observable data; thus optimal decisions are identi\u00ffable from a SMAR trial. Randomization probabilities: Set N k ( s k ; a k-1 ) = n k ( s k ; a k-1 ) and then p k (a k | s k ; a k-1 ) = N k ( s k ; a k-1 ) -1  (11)  Note the time k randomization probabilities are uniform. Then for each j set N j-1 ( s j-1 ; a j-2 ) = nj-1( sj-1; Aj-2) aj-1=1 E[N j ( S j ; j-1 ) -1 | S j-1 = s j-1 ; A j-1 = a j-1 ] -1  (12)  and p j-1 (a j-1 | s j-1 ; a j-2 ) = E[N j ( S j ; A j-1 ) -1 | S j-1 = s j-1 ; A j-1 = a j-1 ] -1 N j-1 ( s j-1 ; a j-2 ) ( ]. The estimating formula, U can be greatly simpli\u00ffed because it is doubly robust  [30]  in that even if the approximations \u02c6 j are inconsistent, as long as the \u02c6 j 's are bounded in probability the estimator \u02c6 d k of EY ( d k ) remains consistent. Thus, for example, the estimator  (7)  for EY ( d k ) results if we set each \u02c6 j to the constant mean d k and solve for d k in  (14) ."
    },
    {
      "title": "Asymptotic variance of",
      "text": "\u221a n \u02c6 d k : Again the potential outcomes notation from the beginning of this appendix is used. We derive the asymptotic variance for the doubly robust estimator; estimator  (7)  follows if one replaces each j by d k . Classical Taylor series argument along with technical assumptions (e.g. Reference  [40] ) imply that\n\nin large samples, equal to -E @ @ d k U ( S k ; A k ; d k ; k ; d k ) -1 \u221a nP n U ( S k ; A k ; d k ; k ; d k ) + k j=1 E @ @ j U ( S k ; A k ; d k ; k ; d k ) \u221a n( \u02c6 jj ) plus terms converging in probability to zero. Note however that E[@=@ j U ( S k ; A k ; d k ; k ; d k )] = 0; this is the Robins' double robustness property. Additionally, it is easy to see that E[@=@ d k U ( S k ; A k ; d k ; k ; d k )] = 1. Thus the asymptotic variance of \u221a n( \u02c6 d kd k ) is equal to the asymptotic variance of \u221a nP n U ( S k ; A k ; d k ; k ; d k ).\n\nNext, express all variables in terms of potential outcomes as in the beginning of this appendix and use the fact that randomization implies that for j = 1; : : : ; K, A j is independent of {(S 1 ; S 2 (a 1 ); S 3 ( a 2 ); : : : ; S k+1 ( a k+1 )) : a k varying in A k } given ( S j ; A j-1 ). To be complete yet conserve space we provide a proof for k = 2 (the general proof is similar but requires more space)."
    },
    {
      "title": "Var(U ) = Var",
      "text": "I {A 2 = d 2 (S 2 (d 1 ); d 1 )}I {A 1 = d 1 } p 2 (d 2 (S 2 (d 1 ); d 1 )|S 2 (d 1 ); d 1 )p 1 (d 1 ) (Y (d 1 ; d 2 (S 2 (d 1 ); d 1 )) -2 (S 2 (d 1 ); d 1 )) + I {A 1 = d 1 } p 1 (d 1 ) ( 2 (S 2 (d 1 ); d 1 ) -d2 ) Using the independence property in addition to the fact that for any random variables, U , Z, Var(U ) = Var(E(U |Z)) + E(Var(U |Z)) (put Z = (Y (d 1 ; d 2 (S 2 (d 1 ); d 1 )); S 2 (d 1 ))) we obtain Var(U ) = Var I {A 1 = d 1 } p 1 (d 1 ) (Y (d 1 ; d 2 (S 2 (d 1 ); d 1 )) -2 (S 2 (d 1 ); d 1 )) + I {A 1 = d 1 } p 1 (d 1 ) ( 2 (S 2 (d 1 ); d 1 ) -d2 ) +E (1p 2 (d 2 (S 2 (d 1 ); d 1 )|S 2 (d 1 ); d 1 ))I {A 1 = d 1 } p 2 (d 2 (S 2 (d 1 ); d 1 )|S 2 (d 1 ); d 1 )p 1 (d 1 ) 2 ( 2 (S 2 (d 1 ); d 1 ) -d2 ) 2 Simplify the \u00ffrst term and use the independence property on the second to obtain, Var(U ) = Var I {A 1 = d 1 } p 1 (d 1 ) (Y (d 1 ; d 2 (S 2 (d 1 ); d 1 )) -d2 ) +E (1p 2 (d 2 (S 2 (d 1 ); d 1 )|S 2 (d 1 ); d 1 )) p 2 (d 2 (S 2 (d 1 ); d 1 )|S 2 (d 1 ); d 1 ) 1 p 1 (d 1 ) ( 2 (S 2 (d 1 ); d 1 ) -d2 ) 2 Once again applying similar arguments to the \u00ffrst variance term yields Var(U ) = Var[Y (d 1 ; d 2 (S 2 (d 1 ); d 1 )) -d2 ] +E 1p 1 (d 1 ) p 1 (d 1 ) (Y (d 1 ; d 2 (S 2 (d 1 ); d 1 )) -d2 ) 2 +E (1p 2 (d 2 (S 2 (d 1 ); d 1 )|S 2 (d 1 ); d 1 )) p 2 (d 2 (S 2 (d 1 ); d 1 )|S 2 (d 1 ); d 1 ) 1 p 1 (d 1 ) ( 2 (S 2 (d 1 ); d 1 ) -d2 ) 2 Now if all treatments are assigned according to d k then each observed S j is equal to the potential outcome, S j ( d j-1 ) and the observed Y is equal to the potential outcome Y (d 1 ; d 2 (S 2 (d 1 ); d 1 )), hence we can re-express the above (for general k) as Var d k (Y ) + k j=2 E d k 1p j (d j | S j ; d j-1 )) p j (d j | S j ; d j-1 )) j-1 '=1 1 p ' (d ' | S ' ; d '-1 )) (Y -j ( S j ; d j-1 )) 2 +E d k 1p 1 (d 1 ) p 1 (d 1 ) (Y -d k ) 2\n\nwhere j ( s j ; a j-1 ) is the limit, in probability, of \u02c6 j ( s j ; a j-1 )."
    },
    {
      "text": "S 2 ; A 1 ) -1 |S 1 = s 1 ; A 1 = b] -|s 1 ) = E[N 2 ( S 2 ; A 1 ) -1 |S 1 = s 1 ; A 1 = a 1 ] -Proceeding backward through time we will see that the randomization probabilities de\u00ffned above balance the sample size among subsequent strategies at each decision. First at the last decision, note thatP[A k = d k | S k = s k ; A k-1 = d k-1 ] = p k (d k | s k ; d k-1 )which does not depend Copyright ? 2004 John Wiley & Sons, Ltd. Statist. Med. 2005; 24:1455-1481where the indicator, I {B} is 1 if the event B occurs and 0 otherwise. Given approximations for each j , (say \u02c6 j ) solve0 = P n U ( S k ; A k ; d k ; \u02c6 k ; d k )(14)for d k and call the solution \u02c6 d k . \u02c6 d k is our estimator of EY ( d k ). In this equation, P n f(X ) is de\u00ffned as the average over the sample, 1=n n i = 1 f(X i ). One possible estimator for each \u02c6 j is \u02c6 ' ( s ' ; a '-1 ) = P n k j=' I {Aj = dj( Sj; Aj-1)} pj(dj| Sj; Aj-1) YI {( S ' ; A '-1 ) = ( s ' ; a '-1 )} P n I {( S ' ; A '-1 ) = ( s ' ; a '-1 )} (15) \u02c6 ' ( s ' ; d '-1 ) is a consistent non-parametric estimator of E[Y ( d k )| S ' = s ' ; A '-1 = d '-1"
    }
  ],
  "references": [
    {
      "title": "A controlled study of a standardized behavioural stepped treatment for hypertension",
      "authors": [
        "M Glasgow",
        "B Engel",
        "D' Lugo"
      ],
      "year": 1989,
      "doi": "10.1097/00006842-198901000-00002"
    },
    {
      "title": "Do tailored behavior change messages enhance the e ectiveness of health risk appraisal? Results from a randomized trial",
      "authors": [
        "M Kreuter",
        "V Strecher"
      ],
      "year": 1996,
      "doi": "10.1093/her/11.1.97"
    },
    {
      "title": "Problem drinkers: evaluation of a stepped-care approach",
      "authors": [
        "F Breslin",
        "M Sobell",
        "L Sobell",
        "J Cunningham",
        "K Sdao-Jarvie",
        "D Borsoi"
      ],
      "year": 1999,
      "doi": "10.1016/s0899-3289(99)00008-5"
    },
    {
      "title": "Improving primary care for depression in late life: the design of a multicenter randomized trial",
      "authors": [
        "Un Tzer",
        "J Katon",
        "W Williams",
        "J Callahan",
        "C Harpole",
        "L Hunkeler",
        "E Ho Ng M, Arean",
        "P Hegel",
        "M Schoenbaum",
        "M Oishi",
        "S Langston"
      ],
      "year": 2001
    },
    {
      "title": "Using behavioral reinforcement to improve methadone treatment participation",
      "authors": [
        "R Brooner",
        "M Kidorf"
      ],
      "year": 2002
    },
    {
      "title": "Flexible treatment strategies in chronic disease: clinical and research implications",
      "authors": [
        "P Lavori",
        "R Dawson",
        "A Roth"
      ],
      "year": 2000,
      "doi": "10.1016/s0006-3223(00)00946-x"
    },
    {
      "authors": [
        "Copyright"
      ],
      "year": 2004,
      "doi": "10.1002/pd.783"
    },
    {
      "authors": [
        "S Murphy"
      ],
      "doi": "10.1093/ww/9780199540884.013.u28527"
    },
    {
      "title": "Adaptive treatment strategies: an emerging approach for improving treatment e ectiveness",
      "authors": [
        "S Murphy",
        "J Mckay"
      ],
      "year": 2003
    },
    {
      "title": "A new approach to causal inference in mortality studies with sustained exposure periods-application to control of the healthy worker survivor e ect",
      "authors": [
        "J Robins"
      ],
      "year": 1986,
      "doi": "10.1016/0270-0255(86)90088-6"
    },
    {
      "title": "The analysis of randomized and Nonrandomized AIDS treatment trials using a new approach to causal inference in longitudinal studies",
      "authors": [
        "J Robins"
      ],
      "year": 1989
    },
    {
      "title": "Information recovery and bias adjustment in proportional hazards regression analysis of randomized trials using surrogate markers",
      "authors": [
        "J Robins"
      ],
      "year": 1993,
      "doi": "10.1007/978-1-4757-1229-2_14"
    },
    {
      "title": "Causal inference from complex longitudinal data. Latent Variable Modeling and Applications to Causality",
      "authors": [
        "J Robins"
      ],
      "year": 1997,
      "doi": "10.1007/978-1-4612-1842-5_4"
    },
    {
      "title": "Marginal mean models for dynamic regimes",
      "authors": [
        "S Murphy",
        "M Van Der Laan",
        "J Robins",
        "Cpprg"
      ],
      "year": 2001,
      "doi": "10.1198/016214501753382327"
    },
    {
      "title": "Dynamic treatment regimes: practical design considerations",
      "authors": [
        "P Lavori",
        "R Dawson"
      ],
      "year": 2003
    },
    {
      "title": "National Institute of Mental Health clinical antipsychotic trials of intervention e ectiveness (CATIE), Alzheimer disease trial methodology",
      "authors": [
        "L Schneider",
        "P Tariot",
        "C Lyketsos",
        "K Dagerman",
        "K Davis",
        "S Davis",
        "J Hsiao",
        "D Jeste",
        "I Katz",
        "J Olin",
        "B Pollock",
        "P Rabins",
        "R Rosenheck",
        "G Small",
        "B Lebowitz",
        "J Lieberman"
      ],
      "year": 2001
    },
    {
      "title": "Depression, IV",
      "authors": [
        "A Rush",
        "M Trivedi",
        "M Fava"
      ],
      "year": 2003,
      "doi": "10.1176/appi.ajp.160.2.237"
    },
    {
      "authors": [
        "P Lavori",
        "A Rush",
        "S Wisniewski",
        "J Alpert",
        "M Fava",
        "D Kupfer",
        "A Nierenberg",
        "F Quitkin",
        "H Sacheim",
        "M Thase",
        "M Trivedi"
      ],
      "year": 2001,
      "doi": "10.1016/s0006-3223(01)01223-9"
    },
    {
      "title": "Evaluating multiple treatment courses in clinical trials",
      "authors": [
        "P Thall",
        "R Millikan",
        "H Sung"
      ],
      "year": 2000,
      "doi": "10.1002/(sici)1097-0258(20000430)19:8<1011::aid-sim414>3.3.co;2-d"
    },
    {
      "title": "Adaptive trials and Bayesian statistics in drug development",
      "authors": [
        "D Berry"
      ],
      "year": 2001,
      "doi": "10.1080/10543409108835007"
    },
    {
      "title": "Optimal adaptive designs for binary response trials",
      "authors": [
        "W Rosenberger",
        "N Stallard",
        "A Ivanova",
        "C Harper",
        "M Ricks"
      ],
      "year": 2001,
      "doi": "10.1111/j.0006-341x.2001.00909.x"
    },
    {
      "title": "Self-designing clinical trials",
      "authors": [
        "L Fisher"
      ],
      "year": 1998
    },
    {
      "title": "Mid-course sample size modi\u00ffcation in clinical trials based on the observed treatment e ect",
      "authors": [
        "C Jennison",
        "B Turnbull"
      ],
      "year": 2003,
      "doi": "10.1002/sim.1457"
    },
    {
      "title": "Dynamic Programming",
      "authors": [
        "R Bellman"
      ],
      "year": 1957
    },
    {
      "title": "Reinforcement Learning: An Introduction",
      "authors": [
        "R Sutton",
        "A Barto"
      ],
      "year": 1998
    },
    {
      "title": "Probabilistic Networks and Expert Systems",
      "authors": [
        "R Cowell",
        "A Dawid",
        "S Lauritzen",
        "D Spiegelhalter"
      ],
      "year": 1999
    },
    {
      "title": "Encyclopedia of Epidemiologic Methods",
      "year": 2000,
      "doi": "10.1002/bbpc.19890930230"
    },
    {
      "title": "Modeling in Medical Decision Making: A Bayesian Approach",
      "authors": [
        "G Parmigiani"
      ],
      "year": 2002
    },
    {
      "title": "Testing for the BRCA1 and BRCA2 breast-ovarian cancer susceptibility genes: a decision analysis",
      "authors": [
        "T Tengs",
        "E Winer",
        "S Paddock",
        "Berry Aguilar-Chavez",
        "Da"
      ],
      "year": 1998
    },
    {
      "title": "A design for testing clinical strategies: biased individually tailored within-subject randomization",
      "authors": [
        "P Lavori",
        "R Dawson"
      ],
      "year": 2000,
      "doi": "10.1111/1467-985x.00154"
    },
    {
      "title": "Statistics for Experimenters",
      "authors": [
        "G Box",
        "W Hunter",
        "J Hunter"
      ],
      "year": 1978
    },
    {
      "title": "Robust estimation in sequentially ignorable missing data models and causal inference models",
      "authors": [
        "J Robins"
      ],
      "year": 1999
    },
    {
      "title": "Optimal dynamic treatment regimes",
      "authors": [
        "S Murphy"
      ],
      "year": 2003
    },
    {
      "title": "Optimal structural nested models",
      "authors": [
        "J Robins"
      ],
      "year": 2003
    },
    {
      "title": "Bandit Problems: Sequential Allocation of Experiments",
      "authors": [
        "D Berry",
        "B Fristedt"
      ],
      "year": 1985
    },
    {
      "title": "Adaptive assignment versus balanced randomization in clinical trials: a decision analysis",
      "authors": [
        "D Berry",
        "S Eick"
      ],
      "year": 1995,
      "doi": "10.1002/sim.4780140302"
    },
    {
      "title": "General keynote: clinical trial design",
      "authors": [
        "D Berry"
      ],
      "year": 2003
    },
    {
      "title": "Selecting therapeutic strategies based on e cacy and death in multicourse clinical trials",
      "authors": [
        "P Thall",
        "H Sung",
        "E Estey"
      ],
      "year": 2002,
      "doi": "10.1198/016214502753479202"
    },
    {
      "title": "Bayesian inference for causal e ects: the role of randomization",
      "authors": [
        "D Rubin"
      ],
      "year": 1978
    },
    {
      "title": "Comment: which ifs have causal answers",
      "authors": [
        "D Rubin"
      ],
      "year": 1986,
      "doi": "10.1080/01621459.1986.10478355"
    },
    {
      "authors": [
        "Copyright"
      ],
      "year": 2004,
      "doi": "10.1002/pd.783"
    },
    {
      "title": "Addendum to a new approach to causal inference in mortality studies with sustained exposure periods-application to control of the healthy worker survivor e ect",
      "authors": [
        "J Robins"
      ],
      "year": 1987,
      "doi": "10.1016/0898-1221(87)90238-0"
    },
    {
      "title": "Approximation theorems of Mathematical Statistics",
      "authors": [
        "Ser Ing"
      ],
      "year": 1980,
      "doi": "10.1002/9780470316481.fmatter"
    },
    {
      "title": "Patterns of change: dynamic typology applied to smoking cessation",
      "authors": [
        "J Prochaska",
        "W Velicer",
        "E Guadagnoli",
        "J Rossi",
        "C Diclemente"
      ],
      "year": 1991,
      "doi": "10.1207/s15327906mbr2601_5"
    },
    {
      "title": "Evaluating a population-based recruitment approach and a stage-based expert system intervention for smoking cessation",
      "authors": [
        "J Prochaska",
        "W Velicer",
        "J Fava",
        "J Rossi",
        "J Tsoh"
      ],
      "year": 2001,
      "doi": "10.1016/s0306-4603(00)00151-9"
    },
    {
      "authors": [
        "Copyright"
      ],
      "year": 2004
    }
  ],
  "num_references": 46
}
