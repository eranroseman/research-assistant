{
  "paper_id": "CRMZH6I7",
  "title": "An Adaptive, Data-Driven Personalized Advisor for Increasing Physical Activity",
  "abstract": "In recent years, there has been growing interest in the use of fitness trackers and smartphone applications for promoting physical activity. Many of these applications use accelerometers to estimate the level of activity that users engage in and provide visual reports of a user's step counts. When provided, most recommendations are limited to popular general health advice. In our study, we develop an approach for providing data-driven and personalized recommendations for intraday activity planning. We generate an hour-by-hour activity plan that is based on the user's probability of adhering to the plan. The user's probability of adherence to the plan is personalized, based on his/her past activity patterns and current activity target. Using this approach, we can tailor notifications (e.g., reminders, encouragement) to each user. We can also dynamically update the user's activity plan at mid-day, if his/her actual activity deviates sufficiently from the original plan. In this paper, we describe an implementation of our approach and report our technical findings with respect to identifying typical activity patterns from historical data, predicting whether an activity target will be achieved, and adapting an activity plan based on a user's actual performance throughout the day.",
  "year": 2015,
  "date": "2015",
  "journal": "J. Med. Int. Res",
  "publication": "J. Med. Int. Res",
  "authors": [
    {
      "forename": "Zhiguo",
      "surname": "Li",
      "name": "Zhiguo Li",
      "affiliation": "the Center for Computational Health , IBM T. J. Watson Research Center , Yorktown Heights , NY 10598 USA \n\t\t\t\t\t\t\t\t Center for Computational Health \n\t\t\t\t\t\t\t\t IBM T. J. Watson Research Center \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t 10598 \n\t\t\t\t\t\t\t\t\t Yorktown Heights \n\t\t\t\t\t\t\t\t\t NY \n\t\t\t\t\t\t\t\t\t USA",
      "orcid": "0000-0002-3834-9801"
    },
    {
      "forename": "Subhro",
      "surname": "Das",
      "name": "Subhro Das",
      "affiliation": "the Center for Computational Health , IBM T. J. Watson Research Center , Yorktown Heights , NY 10598 USA \n\t\t\t\t\t\t\t\t Center for Computational Health \n\t\t\t\t\t\t\t\t IBM T. J. Watson Research Center \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t 10598 \n\t\t\t\t\t\t\t\t\t Yorktown Heights \n\t\t\t\t\t\t\t\t\t NY \n\t\t\t\t\t\t\t\t\t USA",
      "email": "subhro.das@ibm.com",
      "orcid": "0000-0002-7610-2738"
    },
    {
      "forename": "James",
      "surname": "Codella",
      "name": "James Codella",
      "affiliation": "the Center for Computational Health , IBM T. J. Watson Research Center , Yorktown Heights , NY 10598 USA \n\t\t\t\t\t\t\t\t Center for Computational Health \n\t\t\t\t\t\t\t\t IBM T. J. Watson Research Center \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t 10598 \n\t\t\t\t\t\t\t\t\t Yorktown Heights \n\t\t\t\t\t\t\t\t\t NY \n\t\t\t\t\t\t\t\t\t USA",
      "email": "jvcodell@us.ibm.com",
      "orcid": "0000-0002-1020-0861"
    },
    {
      "forename": "Ti",
      "surname": "Hao",
      "name": "Ti Hao",
      "affiliation": "the Center for Computational Health , IBM T. J. Watson Research Center , Yorktown Heights , NY 10598 USA \n\t\t\t\t\t\t\t\t Center for Computational Health \n\t\t\t\t\t\t\t\t IBM T. J. Watson Research Center \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t 10598 \n\t\t\t\t\t\t\t\t\t Yorktown Heights \n\t\t\t\t\t\t\t\t\t NY \n\t\t\t\t\t\t\t\t\t USA",
      "email": "thao@us.ibm.com"
    },
    {
      "forename": "Kun",
      "surname": "Lin",
      "name": "Kun Lin",
      "affiliation": "the Center for Computational Health , IBM T. J. Watson Research Center , Yorktown Heights , NY 10598 USA \n\t\t\t\t\t\t\t\t Center for Computational Health \n\t\t\t\t\t\t\t\t IBM T. J. Watson Research Center \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t 10598 \n\t\t\t\t\t\t\t\t\t Yorktown Heights \n\t\t\t\t\t\t\t\t\t NY \n\t\t\t\t\t\t\t\t\t USA"
    },
    {
      "forename": "Chandramouli",
      "surname": "Maduri",
      "name": "Chandramouli Maduri",
      "affiliation": "the Center for Computational Health , IBM T. J. Watson Research Center , Yorktown Heights , NY 10598 USA \n\t\t\t\t\t\t\t\t Center for Computational Health \n\t\t\t\t\t\t\t\t IBM T. J. Watson Research Center \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t 10598 \n\t\t\t\t\t\t\t\t\t Yorktown Heights \n\t\t\t\t\t\t\t\t\t NY \n\t\t\t\t\t\t\t\t\t USA",
      "email": "maduric@us.ibm.com"
    },
    {
      "forename": "Ching-Hua",
      "surname": "Chen",
      "name": "Ching-Hua Chen",
      "affiliation": "the Center for Computational Health , IBM T. J. Watson Research Center , Yorktown Heights , NY 10598 USA \n\t\t\t\t\t\t\t\t Center for Computational Health \n\t\t\t\t\t\t\t\t IBM T. J. Watson Research Center \n\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t 10598 \n\t\t\t\t\t\t\t\t\t Yorktown Heights \n\t\t\t\t\t\t\t\t\t NY \n\t\t\t\t\t\t\t\t\t USA",
      "email": "chinghua@us.ibm.com"
    }
  ],
  "doi": "10.1109/jbhi.2018.2879805",
  "keywords": [
    "Data-driven",
    "fitness tracker",
    "health behavior",
    "personalized recommender system",
    "physical activity. I"
  ],
  "sections": [
    {
      "text": "of wearable and mobile health technologies has become an increasingly popular method for promoting physical activity  [5] . Examples of such technologies include wearable devices (e.g., chest/waist bands, wrist bands, and smart watches, etc.) that are mounted with multiple sensors (e.g., accelerometers, magnetometers, gyroscopes and photoplethysmogram sensors). As a result, an abundance of physical activity data measured by these sensors can be fed back to users through smartphone applications (or apps). Typically, these smartphone applications provide elaborate interfaces that allow users to visually track their activity levels. Case et al.  [6]  showed that the smartphone apps and wearable devices used in their study were accurate for tracking step counts. Other studies have used accelerometer data to effectively recognize/classify static and dynamic user states  [7] , everyday activities such as walking, running, and cycling  [8] , and the types of body movements (e.g., sit-to-stand, lying, walking, etc.)  [9] .\n\nDespite their growing popularity, the influence of such technologies on health behavior change is still not clear  [4] ,  [10] . While the use of fitness tracking devices and mobile apps may achieve high levels of short-term adoption and behavior change, eventual abandonment of the technologies is a common observation  [11] -  [13] . Chung and Danis  [14]  interviewed users of a popular fitness device to understand why they may have stopped using their devices and apps. They learned that while existing technologies may provide encouraging messages and reminders about past activity levels, they do not provide users with strategies for meeting activity targets  [15] . In particular, participants wished that their device would help them to plan their activity levels throughout the day, and help them to adapt to unexpected changes in their work, life, and social routines. The needs expressed by these users served as an inspiration for our current work. Further, studies have shown that tailored interventions have the potential to increase the effectiveness of computer-based health behavior interventions  [16] . In this paper, we implement a data-driven, personalized advisor system to support intraday planning of physical activity.\n\nSince walking has been viewed as a feasible and convenient means of engaging in physical activity for general health promotion  [17] ,  [18] , this paper utilizes step count as a measure of physical activity. We provide users of fitness tracking devices with an hour-by-hour plan for achieving a daily step target that is personalized to them based on the users' past activity behaviors and other user characteristics. A survey of existing work on adaptive interventions shows that most efforts focus on adapting daily goals every 7-9 days, based on the individual's past achievements  [19] -  [21] . Everett et al.  [22]  trialed a mobile app that splits daily targets into smaller segments throughout the day. However, they do not report the algorithm(s) used to perform the segmentation.\n\nThroughout the day, our system predicts when a user's probability of achieving their daily step target falls below a certain threshold, and adapts the activity plan and/or the daily target so that the daily target remains realistic to achieve. Although Dijkhuis et al.  [23]  also predict the probability that a user will meet their daily goal, they do not adapt the goal based on their prediction. Meanwhile, Rabbi et al.  [24]  implemented a system that actually suggests specific activities (e.g., taking small walks in a particular location) for the user to engage in, based on the frequency with which a user has performed such activities in the past. According to behavior change theory  [25] , some users not only need help recognizing opportunities to change their behavior, but also need specific guidance on how to change. Therefore, our system aims to address both these needs.\n\nUsing the hour-by-hour activity plan, as opposed to just the daily target as a benchmark, we can notify users whether they are \"on track\" relative to their hour-by-hour plan. This can be more useful than simply reporting the gap between their current activity level and their daily target. It provides users with a clearer sense for whether they are likely to meet their target by the end of the day, even though it may be early in the day. This gives them an opportunity to adapt their behaviors earlier rather than later. For example, two users may have the same daily activity target of 7,500 steps. By 1 pm, the first user may have achieved 2,000 steps and the second user may have achieved 5,000 steps. The second user may be closer to his daily target, but if he typically performs 90% of his activity in the morning, he may actually be at risk of missing his target. Meanwhile, if the first user typically performs 90% of his activity in the afternoon, then he may in fact be in a good position to exceed his target.\n\nIn support of the advisor system previously described, the technical contributions of this paper are as follows:\n\ni) We identify \"typical activity patterns\" from historical activity data via two-level clustering. These activity patterns form the basis of our personalized hour-by-hour activity plan and any mid-day plan adaptations. ii) We predict the probability that a user will achieve their daily activity target, given their current level of achievement and their typical activity pattern. This prediction is used to tailor notification timing and content, and to trigger potential adaptations to the current plan. iii) We generate realistic adaptations of a user's original activity plan, if/when the probability that a user will achieve their activity target is below, or above, predefined threshold levels. We organize our paper as follows: In Section II, we provide an overview of the physical activity advisor system that we prototyped as a mobile phone application. In Section III, we describe the data set and methodology used. In Section IV, we report on the performance of our prototype. Finally, we summarize our work and discuss the future research directions."
    },
    {
      "title": "II. THE PHYSICAL ACTIVITY ADVISOR SYSTEM",
      "text": "The main framework for the physical activity advisor system is illustrated in Fig.  1 . The system comprises both offline and online components. Offline, the system performs clustering and predictive model building and stores the results in a persistent analytical data store. Online computations for the advisor are triggered when a new user arrives, for whom personalized recommendations are made throughout each day. The offline components comprise:\n\nHistorical Data Pre-processing: the raw data are staged through two approaches -the batch approach for structured summary data (e.g., aggregated fitness data) and the event-driven approach for time series data (e.g., step count trajectories). The data are then cleaned and formatted before the relevant data are merged.\n\nFeature Generation and Clustering: We perform two-level clustering to identify the typical daily activity patterns observed across users (more details are provided in the Data and Methods section).\n\nPredictive Model Building: On the basis of the clustering results, two types of predictive models are constructed to i) identify the contextual user group for a new user, and ii) calculate the probability of the user meeting his/her daily activity target.\n\nThe clustering results, daily activity patterns and trained predictive models will be saved into the persistent analytical data store for future use by the advisor. In the case that substantial new data (structured summary data and/or time series) become available later, the offline steps may be re-implemented, and the new results will be updated in the data store.\n\nWe refer to the online components as the Data-Driven Personalized Advisor: First, we classify a new user into one of the identified contextual user groups in order to find his/her typical activity patterns. Next, an hour-by-hour activity plan is recommended to this user based on his/her typical daily activity patterns. Then, the system dynamically adapts throughout the day as real-time information about actual activity levels become available. We periodically predict the user's success probability of meeting his/her daily activity target. If the probability is low (compared to a specified threshold), the user receives a notification in the app, and an updated activity plan is suggested to the user for the remaining hours of the day. Since every recommendation is based on the individual's personal context and history, we expect our recommendations to be easier for the user to adhere to. This system was prototyped as an interactive application on a smartphone (please refer to  [26]  for details)."
    },
    {
      "title": "III. DATA AND METHODS"
    },
    {
      "title": "A. Data",
      "text": "The study population consisted of 505 fitness tracking device users, out of which 203 were females (40.2%). The dataset used in this study consists of two parts -user contextual features and daily trajectories of steps over time. For each user, there were 20 contextual features in the user summary data (a detailed description of these features is provided in Appendix Table  II ), which can be divided into three major categories: r Physiological characteristics: gender, height, last reported weight, last reported Body Mass Index (BMI), average & standard deviation of weight per weigh-in, average & standard deviation of BMI per weigh-in, average & standard deviation of fat percentage per weigh-in, number of distinct weight measurement devices; r Fitness activity (excluding step trajectories): average & standard deviation of time spent per workout, average & standard deviation of calories burnt per workout, number of distinct workout sub-activities, ratio of the number of reported workouts to the number of days in the system, ratio of the number of reported weigh-ins to the number of days in the system; and, r Geographic location: latitudinal & longitudinal coordi- nates of the starting country/state. The geographic location is included in the model because the Centers for Disease Control and Prevention reports that the rates of activity/inactivity are different across states and regions across the United States  [2] . In addition to the contextual features, 476 of these users also had daily step-count trajectories which were generated over a two-year period (July 2014 -July 2016). On average, there are 466.2 data points in a daily step count trajectory recorded for each user. From these step-count trajectories, cumulative hourly step counts by day and the total daily step counts can be obtained for each user. In total, the step counts were recorded over 104,747 activity days, (the average number of activity days per user is 220.1 days), and the average daily step count among all users is 6,675 steps per day. Overall, the users walked at least 10,000 steps in a single day (a commonly specified guideline  [27] ) on 21.0% of their activity days."
    },
    {
      "title": "B. Methods",
      "text": "A systematic data-driven methodology for data analysis and modeling is developed to set up the activity targets and hourby-hour action plans, assess the probability of a user meeting the daily activity target, and adjust the activity plan when this probability meets a certain threshold criterion. A flow chart illustrating this method is provided in Fig.  2 . First, multi-level clustering is implemented to generate contextual user groups and identify the daily activity patterns. Next, predictive models are built to predict the contextual user group for a new user and forecast the probability of the user meeting his/her activity target that day, for each preset time slot (e.g., every hour in an activity period).\n\nFrom this figure, we can see there are three major offline steps (steps i, ii, and iii) and three major online steps (steps iv, v, and vi shown in the dashed box) in the process: i) a first-level clustering of user groups based on the contextual features on the level of user population; ii) spline fitting of each user's cumulative daily step-count trajectories, and a secondlevel clustering of activity patterns using the fitted splines, for each identified contextual user group from the first-level clustering; iii) predictive model building for user classification and predicting probabilities of meeting the daily activity target at the preset time slots on the level of contextual user group; iv) activity plan setting for a new user (e.g., steps at each preset time slot) given the real-life constraints (e.g., work schedule, meetings) using the sub-cluster of activity patterns; v) prediction of probability for meeting the daily target at the preset time slots using the predictive models trained for this user's contextual group with step counts collected incrementally over time in a day; and vi) if an alert is raised, suggesting an updated activity plan using a stochastic process control approach (e.g., Linear-Quadratic Regulator  [28] )."
    },
    {
      "title": "C. Two-Level Clustering",
      "text": "An assumption of this study is that a user's contextual features can be known from historical data before he/she starts to use our advisor. In this study, a two-level clustering method was implemented, and Fig.  3  illustrates the clustering process for identifying contextual user groups and typical daily activity patterns within each contextual user group. On the first level (user population level), all contextual features were used to derive the user groups so that the within-group members have similar physiological features, historical fitness features and the geographical locations. On the second level (contextual user group level), we cluster the daily activity patterns using the engineered features calculated from the historical daily step trajectories from all users in each user group identified on the first level. Later, the clustered daily activity patterns (i.e., behavioral profiles) will be used in action planning.\n\n1) First-Level Clustering: We performed clustering on the population of users based on their contextual features. The resulting clusters are referred to as \"contextual user groups\". Due to the existence of both categorical and continuous variables in the features, the agglomerative hierarchical clustering with the Gower distance  [29]  (missing values are allowed) is used, and the number of clusters is determined according to the Dunn Index  [30]  (for cluster validity) and domain knowledge. Denoting the number of clusters as n c , the Dunn Index is defined as:\n\nwhere the numerator d(c i , c j ) is the dissimilarity function between the clusters c i and c j , and in the denominator diam(c k ) is the diameter of the cluster c k . They are defined by Eq. (  2 ) and Eq. (  3 ), respectively:\n\nwhere d(x, y) is the distance between x and y. This index does not have any trend with respect to n c , and a large Dunn index value is preferred because it indicate the presence of compact and well-separated clusters.\n\n2) Contextual User Group Classification Model: To predict the contextual user group that a new user belongs to, a classi-fication model is trained (e.g., decision tree, SVM, or Random Forests  [31] ) with all contextual features (predictors) and the user group ids as class labels (response). When the contextual features of a new user are known, the user group can be predicted accordingly. In practice, if the contextual features of a new user are only partially available (e.g., the physiological characteristics are known but the fitness activity related features are missing), we can use the available features to calculate the distance of the new user to the center of each identified contextual user group and assign him/her to the closest group, or train a new classification model (but probably with worse accuracy) just using the available contextual features.\n\n3) Second-Level Clustering: In the second-level clustering, we aim to find the typical daily activity patterns for each contextual user group. The typical activity patterns were created by performing clustering over the daily step-count trajectories of all the users in a given contextual user group. First, to generate the trajectories, we fit smoothing splines to the daily cumulative step counts for each user. These smoothing splines remove the noise in the trajectories and impute missing values at any specified time point within the activity period. Second, we engineered features from the fitted splines and used these features for performing the clustering within each contextual user group. We now describe these two steps in further detail.\n\nFor a given daily trajectory of step counts X ij (t) for the ith user and the j-th day, i = 1, 2, . . . , N, j = 1, 2, . . .d i , a smoothing spline with knots at the unique values of t k , where t k is the time of the kth record, k = 1, 2, .., s ij and s ij is the number of records in X ij (t), minimizes the penalized residual sum of squares:\n\nwhere f(t) stands for all functions with two continuous derivatives (e.g., the cubic smoothing splines are used in this study), X ij k = X ij (t k ), and \u03bb is a fixed penalty constant. When \u03bb increases, the resulting curve will be smoother. In order to select the smoothing parameter \u03bb, the cross-validation sum of squares CV(\u03bb) should be constructed first, and the optimal \u03bb is selected over a suitable range to minimize CV(\u03bb). The readers are referred to  [32]  for details. An example plot of the fitted smoothing spline (the dashed line) is shown in Fig.  4 . From this figure we can see that the smoother (dashed line) accurately tracks the cumulative step counts over time.\n\nNext, the engineered features were created by two-fold thresholding  [33]  of the hourly steps from the fitted cumulative splines: the step counts above the upper threshold provide the spike features, whereas the ones below the lower threshold provide the sedentary features. The thresholds are chosen based on domain knowledge. Tudor-Locke and Bassett  [34]  stated that 5,000-7,499 steps/day is typical of daily activity and considering a user is awake (not sleeping) for 16 hours/day on average, he/she needs to walk a little over 300 steps per hour to meet 5,000 steps in a day. In our anslysis, if the number of steps within an hour is more than 300, then the user is considered to be active during that hour, and, if the user walks less than 20 steps in an hour, he/she is considered to be inactive during that hour. The spike frequency constitutes the number of hours per day that the user walks more steps than the spike threshold, and the mean, median, minimum and maximum spike intensities denote those corresponding metrics on the step counts completed in those hours. On the other hand, the sedentary duration denotes the fraction of hours per day that the user walked less steps than the sedentary threshold. We also considered the corresponding mean, median, minimum and maximum of the sedentary hours per day as the sedentary time-series features for clustering. Using the spike-sedentary features along with the other direct features from the steps time-series, we cluster the daily activity of all the users from a contextual user group.\n\nWe implemented hierarchical clustering  [35]  with Ward linkage method and Euclidean distance metric. The Ward variance minimization algorithm  [36]  computes the linkage array by minimizing the total intra-cluster distance (Euclidean) variance. We determined the number of clusters by combining domain knowledge with the automatic variant of \"elbow method\", where we find the cluster number transition that leads to the maximum acceleration of distance growth.\n\nThen for each user, we find his/her activity pattern distribution over the seven days of the week. This distribution represents the likelihood that a user engages in a certain activity pattern on a certain day. Hence, we find that activity patterns in the right context such as days of the week may be predictable because of a recurring individual patterns exist for most people, and may serve as the foundation for recommending an hour-by-hour activity plan."
    },
    {
      "title": "D. Target Activity Plan Setting",
      "text": "On the basis of the results from the two-level clustering analysis, we can recommend an hour-by-hour activity plan to a user of the advisor. At the first place, the group for the user will be predicted using the classification model built on the contextual features. After we find the user group for a new user, we may have the following two situations: a) If we have the user's historical step count trajectories and thus can derive his/her activity pattern distributions over the seven days of the week, at any time point, we can plan the remaining hourly activity required for the user to meet the target based on the activity patterns of the profile that user belongs to on that day. For example, on Tuesday, we can use the \"evening intensive\" pattern as the target activity plan if it is the most frequent pattern on Tuesdays. The recommended step-counts for each remaining hour in the day are proportional to that activity pattern distribution. At the beginning of the day or whenever the user adjusts his/her activity target for the day, the step-count balance, i.e., the difference between the total target and the steps completed so far, is distributed across the remaining hours using a ratio derived from the activity pattern distribution. b) If the user's historical step count trajectories are unavailable and thus we do not have the activity pattern distributions of this user, we can use the activity pattern distribution for the whole contextual user group (to which the user belongs) to set the activity plan. That is, for an activity day, the activity pattern which occurred most frequently in the user group will be used as the target plan. If this target plan does not work due to the user's real-life time constraints, then the next frequent activity pattern can be used instead."
    },
    {
      "title": "E. Data Driven Predictive Model for Meeting Activity Targets",
      "text": "For each contextual user group, a set of predictive models is built to predict the probability of a user meeting the daily target. The response is a binary variable which equals to 1 if the target is met, and otherwise equals to 0. The probability will be calculated in the range of 0 to 1. The input features include the day of the week for each activity day (Sunday through Saturday), and the cumulative steps from the start of the activity period at the preset time slots to the current time point for each user, as well as the contextual features used in the first-level clustering.\n\nIn this study, to investigate the trend of prediction performance, the start of the activity period is set as 12 AM and the period ends at 11 PM. In practice, a reasonable period can be set according to the user's schedule (e.g., 6 AM to 9 PM) and/or historical activity patterns.\n\nDepending on the input features to be used, two types of predictive models can be built. Type I models include all the above-mentioned features except for the contextual features, while Type II models use all features. We use Type I models as the baseline models, and their performance will be compared to the second model type. The aim is to check if the contextual features should be included in modeling or not.\n\nIn this study, for each of the two model types, 24 models (Model ID = 0, 1, . . . , 23) are built for every contextual user group. In Type I models, the first model (Model ID 0) is built at 12 AM and it uses the day of the week as the only input feature because it is the start of the activity period and thus no steps are recorded yet. The ith model is built for the ith hour of the day, and it takes (i+1) input features: the day of the week and the cumulative step counts at every hour up to the ith hour. For example, Model ID 8 was constructed for 8 AM and its 9 input features are the day of the week and the cumulative steps taken at 1 AM, 2 AM, . . . , up to 8 AM. Type II models are built by adding the contextual features into the inputs for the corresponding Type I models. Since there are 20 contextual features, the i-th Type II model has (i + 21) features."
    },
    {
      "title": "F. Activity Plan Adjustment Using LQR Planner",
      "text": "As described above, the app developed in this study collects the step count trajectories of a user, and periodically calculates the probability of this user meeting the daily target. At each preset time slot, if the probability is lower than a threshold, an alert will be raised by the predictive model to warn the user. After the alert is raised, if we also detect that the user's current step count deficit (with respect to the preset target activity plan) exceeds the configurable threshold, then the activity planner is triggered and an alternative plan will be suggested. On the contrary, if the user is far ahead of the activity plan at a time point, the daily target can be adjusted and a new activity plan can be recommended to the user. The alternative activity plan generation can be formulated as a linear-quadratic-Gaussian control (LQG) problem, to which the linear-quartic regulator (LQR) is the solution  [26] .\n\nIn the field of optimal control, LQR is a standard solution to the problem of tracking. Let us denote the shortfall of the cumulative steps at each time point as a discrete-time system describe by\n\nwhere x t is the state variable at time t with x init as the initial state, u t is the input variable, and A(t) and B(t) are state matrix and control matrix, respectively. The goal is to closely track a desired trajectory (e.g., the trajectory shown on Fig.  4 ) by minimizing the corresponding objective function defined as\n\nwhere H is called time horizon, U = (u 0 , . . . , u H -1 ), and Q(t) \u08d9 0, Q f = Q(H) \u2265 0, R(t) > 0 are given state cost, final state cost, and input cost symmetric matrices.\n\nThe objective function encapsulates the trade-off between the desire to follow the target trajectory (the first term in Eq. (  6 )) and using the small input effort (the second term) as we do not want to exhaust the users. The LQR problem is to find u lq r o , u lq r 1 , . . . , u lq r N -1 that minimizes J(U). LQR can be formulated as a least-square problem, and its solution can be found using dynamic programming. If the matrices A, B, Q, and R are all constant matrices, the dynamic system is time invariant; otherwise it is time-varying.\n\nIn our application, the state variable x t is the step deficit at time t, which is hour of the day, and thus the time horizon H \u08d8 24 depending on the specified timeslots in an activity period (e.g., every hour in 8 AM -10 PM, H = 15). When the actual steps are collected up to time s, 0 \u08d8 s < H-1, we can find the optimal solution u lq r s+1 , u lq r s+2 , . . . , u lq r H -1 to reach the daily activity target for the remaining time of the day.\n\nThere are three components in the plan adjustment system: (i) target activity plan input, (ii) the time constraint integrator which looks at the user's real-life time constraints (e.g., meet-ings, exercise class on the calendar) to generate the weighted penalties as inputs to LQR, and (iii) the linear quadratic planner which takes the penalties and target activity plan, and adjusts the activity plan dynamically for the user according to his/her actual step counts. In component (ii), the time constraints of a user can be translated into penalty functions, Q(t) and R(t), t = s+1, s+2, . . . , H-1, by putting high penalty values for periods of unavailability. In practice, the values of these penalties can be set through trial and error method. When the time constraints are updated, the activity plan can be adjusted adaptively with the updated penalties."
    },
    {
      "title": "IV. RESULTS"
    },
    {
      "title": "A. First-Level Clustering",
      "text": "According to the Dunn Index, we successfully identified 6 contextual user groups in our first-level clustering. The summary statistics of the contextual features (Appendix Table  II ) for these groups are listed in Appendix Table  III . A close look at the table reveals that user groups 2 and 6 are almost all female users, groups 3 and 5 are all males, while the other two groups (1 and 4) are mixed-gender groups. In particular, Group 6 contains only 3 users (all female), and this group is far away from the cluster centers of the other groups on the t-SNE plot (Appendix Fig.  11 ). Moreover, this group has the smallest last reported weight, the lowest last reported BMI and average BMI, and the three female users worked out with the highest participation rate and average time, and burned the most calories per workout. The pairwise t-tests (with small sample size  [37] ) show that the above features of this group are significantly different from those of the other groups. Statistically speaking, this group can also be viewed as an outlying group  [38] ."
    },
    {
      "title": "B. User Classification Model",
      "text": "A Random Forest model was trained to classify new users into the contextual user groups. The overall out-of-bag (OOB) error rate across all user groups is approximately 3.8%. Appendix Table IV lists the summary statistics of the daily step counts by user group."
    },
    {
      "title": "C. Second-Level Clustering",
      "text": "As stated in the second-level clustering in Section III, we have chosen the spike threshold to be 300, i.e., any hourly step count above 300 is considered a spike, and the sedentary threshold to be 20, i.e., any hourly step count less than 20 is considered sedentary. The derived spike and sedentary features for user group 1 are summarized in Appendix Table  V .\n\nUsing the derived spike-sedentary features and the other direct features from the step count trajectories, we clustered the daily activity of the users by the contextual user group. As an example, user group 1 has 34 users with 9,149 days records. After clustering these days, we get four distinct activity patterns -\"morning intensive walking\", \"afternoon intensive walking\", \"evening intensive walking\" and \"Uniform walking all day\" as shown in Fig 5 . The activity patterns are named from the location of the peak in the distribution of the average hourly steps. For example, the peak for the pattern 'morning intensive walk- TABLE I THE NUMBER OF IDENTIFIED TYPICAL ACTIVITY PATTERNS BY USER GROUP Fig. 6. Activity pattern distribution of one particular user across the different days of the week.\n\ning' occurs around 9AM. Table  I  lists the number of identified typical activity patterns by contextual user group."
    },
    {
      "title": "D. Target Activity Plan Setting",
      "text": "After the four types of activity patterns were identified, we generated an activity pattern distribution for each user, for each day of the week, as shown in Fig.  6 . On any given day, the distribution reflects the likelihood that a user may engage in each type of activity pattern. Based on this figure, we can see that this user walked \"uniformly all day\" on most days, except on Tuesdays when he was more likely to engage in an \"evening intensive\" activity pattern.\n\nUsing the pattern distribution of a user, the target activity plan can be suggested for a given step target. Fig.  7  is a screenshot of the app which illustrates the activity planning of a \"morning intensive\" user. When the activity day is Monday and the step target is set as 10,000 steps, two hour-by-hour activity plans are Fig.  7 . App screenshot of target activity plan suggestions for a \"morning intensive\" user (Fig.  2  of  [24]  with permission).\n\nsuggested. If the user selects the first plan from the top (left panel of Fig.  7 ) according to his time constraints, he will walk most steps in the morning from 9 AM to 12 PM. If the other plan is selected (right panel), he will walk less steps from 9 AM to 12 PM but more in the period between 3 PM and 6 PM."
    },
    {
      "title": "E. Data-Driven Predictive Models for Meeting Activity Targets",
      "text": "In our study, the daily target was set as 10,000 steps, and four widely used statistical and machine learning classification methods were fit to the data. These models included logistic regression (LR), random forest (RF), support vector machine (SVM) and neural network (NN). Their performance was compared to each other by contextual user group where the data were randomly divided into the training data (80%) and the test data (20%).\n\nThe parameters for the three machine learning models are: (1) RF: the number of trees ntree = 500, and the number of variables randomly sampled as candidates at each split mtry = sqrt(p), where p is the number of features in the data; (2) SVM: the kernel function used here is Gaussian radial basis kernel, the inverse kernel width (sigma) and the cost of constraints violation (C) are tuned using the 10-fold cross validation;\n\n(3) NN: the number of units in the hidden layer size = 20, and the parameter for weight decay = 0.5.\n\nThe area under the Receiver Operating Characteristic curve (AUROC) for the test data is used as the metric for comparing the model performance. As an example, the AUC values over time from the Type II models using the four methods are illustrated in Fig.  8 (a) and (b), which show the results for the user groups 2 and 4, respectively. It seems that the RF models (the first curves from the top in Fig.  8   possibility of a user meeting the activity target. The results of the other groups have similar trends in the AUC values.\n\nIn Fig.  8 (a) for the user group 2, the RF models (the first curve from the top) yield an AUC value of 0.76 at 12 AM (Model ID 0), and after that the AUC value goes up and exceeds 0.8 at 7 AM (Model ID 7), as the step counts are incrementally collected over time and included in the inputs to the models.\n\nFor Group 4 (Fig.  8(b )), the AUC value of the RF models is at 12 AM (Model ID 0) and greater than 0.8 at 8 AM (Model ID 8). Both results show that the RF models have satisfying performance in predicting if a user can meet the daily activity targets from early in the morning of an activity day.\n\nWe also compared the performance of Model Types I (without contextual features) and II (with contextual features). Since contextual features are not used, Type I Models have worse prediction performance in terms of the AUC values. The results for the user groups 2 and 4 are shown in Appendix Fig.  12 . In this figure, for both user groups, the AUC values are close to 0.5 in the beginning and reach above 0.8 at 11 AM. Therefore, we can conclude that the contextual features should be used in the models to achieve better prediction accuracy, as long as the contextual features of the users are available."
    },
    {
      "title": "F. Activity Plan Adjustment Using LQR",
      "text": "As described in the method section, when the difference between the target plan and the actual steps is large enough for  an alert to be raised by the predictive models, the advisor will send a notification to the user, and an adjusted activity plan can be generated by the LQR planner. Fig.  9  illustrates an example. When the same user as in Fig.  7  was 2,598 steps behind the plan at 11 AM, the advisor notified the user and suggested adjusting the hour-by-hour plan for achieving the same daily target. When the user clicks on \"review plan\", he/she can see the suggested plan adjustment with increased steps for the remaining hours of the day (the first curve from the top is the suggested plan). Of course, a lower target (e.g., 5K steps) can also be suggested by the system if a user is so far behind the plan that the probability he can meet the final goal (10K steps) is quite low. On the other hand, if a user is ahead of the plan by 272 steps at 2 PM (see Fig.  10 ), the advisor could encourage her to raise her daily target from 10K to 15K steps and suggest a new activity plan for the remaining hours to help her meet the higher target.\n\nTABLE II CONTEXTUAL FEATURES AND DESCRIPTIONS"
    },
    {
      "title": "V. CONCLUSION AND DISCUSSION",
      "text": "We have designed and implemented a data-driven system to generate daily activity plan recommendations in real-time to support users trying to meet their daily activity targets. Our advisor system takes advantage of the abundant physical activity data collected from a large population of fitness tracker users to develop clusters of contextual user groups. From these contextual user groups, we identify the typical daily activity patterns by group, and use them to set a user's hour-by-hour activity plan. We monitor their activity and send notifications to the users based on the probability of meeting the daily target. When the probability of achieving the daily activity target is sufficiently low, we suggest an alternative hourly activity plan and/or daily goal.\n\nIn our current implementation, the online component of our system runs on a smartphone. The calculation needed to generate the adaptive activity plan occurs hourly by taking into account the user's steps for the past hours in the same day. As the twolevel clustering and the predictive model training, which are the computationally expensive steps, are conducted off-line (e.g., on the cloud), the hourly online calculation on the smartphone mostly involves light-weight computations that predict success probability of reaching the target using the pre-trained models, therefore resulting in minimal power consumption.\n\nOne concern that many users may have is in regards to excessive notifications. In our system, we address message fatigue by controlling the timing and content of our messages. Since our messages are driven by the probability of achieving one's goal, we avoid updating users of their progress unless they are deviating significantly from what is usual for them. Additionally, we limit messages that simply provide a report of their progress at regularly spaced time intervals. Instead, we focus on providing the user with suggestions on actions to be taken.\n\nIn this work, we did not focus on the usability aspects of the application interface, nor did we perform a user evaluation study. Therefore, reasonable next steps include conducting user studies that will allow us to improve the user interface so that usability issues do not inhibit us from evaluating the effectiveness of the computed insights. In order to evaluate the effectiveness of our insights in increasing physical activity, we would need to conduct a randomized controlled trial (RCT) (An example of how RCTs are conducted using smartphone-based interventions is provided in a weight loss study conducted by Martin et al.  [39] ). In a review by Gilmore et al.  [10] , few commercially available apps for increasing physical activity are well-validated, and further research is required.\n\nIt should be noted that while our approach addresses behavior barriers related to the user's ability to identifying a plan of action, there exist other barriers to behavior, such as motivation. Lee et al.  propose an approach to increasing physical activity that targets the user's reflective motivation  [40] . Such an approach is complementary to ours, and could, for example, be seen as a way to encourage users to accept more aggressive step goals. A potentially useful technological addition to our system would be to integrate a drift detection  [41]  and automatic model adaptation pipeline into the framework to address any potential non-stationarity in the step-count distribution. Still, as noted by Spanakis et al.  [42] , in any large-scale implementation of an mHealth intervention, issues related to data security, privacy, trust, and organizational dynamics will also need to be addressed."
    },
    {
      "title": "APPENDIX",
      "text": "Appendix Table II lists the user contextual features and the descriptions. The summary statistics for the identified user groups, the daily step counts by user group, and the calculated spike and\n\nTABLE III FEATURE CHARACTERISTICS OF USER GROUPS * N is the number of users in a user group. The numbers outside of (inside) the parentheses are the means (standard deviations) of the characteristics.\n\nTABLE IV SUMMARY STATISTICS OF THE DAILY STEP COUNTS BY USER GROUP TABLE V SUMMARY STATISTICS OF THE SPIKE AND SEDENTARY FEATURES (USER GROUP 1) Authorized licensed use limited to: The University of Iowa. Downloaded on August 05,2025 at 03:49:52 UTC from IEEE Xplore. Restrictions apply. sedentary features for user group 1 can be found in Appendix Table  III , IV, and V. Fig.  11  illustrates the t-SNE plot of the 6 contextual user groups from the first-level clustering, and Fig.  12  plots the AUC values of the Type I models built for users in group 2 (a) and group 4 (b) using four classification methods."
    },
    {
      "title": "ACKNOWLEDGMENT",
      "text": "This paper is dedicated to the memory of Dr. H. Chang, a visionary and optimist from whom the authors took much inspiration. The authors would like to thank Dr. C. Partovian for her valuable input."
    },
    {
      "text": "Fig. 1. Main framework for the physical activity advisor system."
    },
    {
      "text": "Fig. 2. Flow chart for data analysis and modeling (online computations are illustrated in the dashed box)."
    },
    {
      "text": "Fig. 3. Illustration of two-level clustering based on contextual features and historical daily activity patterns (please refer to Fig. 5 for the clustering results of typical activity patterns)."
    },
    {
      "text": "Fig. 4. An example smoothing spline fitted to a time series of the daily step counts for a paticular user. The horizontal line is the daily target of 10,000 steps. The dark dots are the observed step counts, and the red dashed line represents the fitted smoothing spline."
    },
    {
      "text": "Fig. 5. Clustering of daily activities; x-axis is hour of the day in a 24 hour cycle, y-axis is the average step count."
    },
    {
      "text": "(a) and (b)) have the largest AUC values at most times in an activity day. Thus we can conclude that RF outperforms the other three modeling methods in predicting the"
    },
    {
      "text": "Fig. 8. AUC values of the Type II models built for users in group 2 (a) and group 4 (b) using four classification methods. The x-axis is the hour/model ID (0 to 23) and the y-axis is the AUC value."
    },
    {
      "text": "Fig. 9. App screenshot of target activity re-planing for a \"morning intensive\" user who is falling behind on his plan."
    },
    {
      "text": "Fig.10. App screenshot of target activity plan suggestion for a \"morning intensive\" user who is overachieving on her plan."
    },
    {
      "text": "Fig. t-SNE of the six contextual user groups using the agglomerative hierarchical clustering."
    },
    {
      "text": "Fig. 12. AUC values of the Type I models built for users in group 2 (a) and group 4 (b) using four classification methods. The x-axis is the hour/model ID (0 to 23) and the y-axis is the AUC value."
    }
  ],
  "references": [
    {
      "title": "Facts About Physical Activity",
      "year": 2015,
      "doi": "10.1037/e525092010-001"
    },
    {
      "title": "Effectiveness of a web-and mobile phone-based intervention to promote physical activity and healthy eating in middle-aged males: Randomized controlled trial of the ManUp study",
      "authors": [
        "M Duncan"
      ],
      "year": 2014,
      "doi": "10.2196/jmir.3107"
    },
    {
      "title": "Behavior change with fitness technology in sedentary Adults: A review of the evidence for increasing physical activity",
      "authors": [
        "A Sullivan",
        "M Lachman"
      ],
      "year": 2017,
      "doi": "10.3389/fpubh.2016.00289"
    },
    {
      "title": "Wearable Device, mHealth, Telehealth Markets Expected to Grow",
      "authors": [
        "T Beaton"
      ],
      "year": 2005
    },
    {
      "title": "Accuracy of smartphone applications andwearable devices for tracking physical activity data",
      "authors": [
        "M Case"
      ],
      "year": 2015,
      "doi": "10.1001/jama.2014.17841"
    },
    {
      "title": "A Triaxial Accelerometer-Based physical-activity recognition via augmented-signal features and a hierarchical recognizer",
      "authors": [
        "A Khan",
        "Y.-K Lee",
        "S Lee",
        "T.-S Kim"
      ],
      "year": 2010,
      "doi": "10.1109/titb.2010.2051955"
    },
    {
      "title": "Activity classification using realistic data from wearable sensors",
      "authors": [
        "J P\u00e4rkk\u00e4",
        "M Ermes",
        "P Korpip\u00e4\u00e4",
        "J M\u00e4ntyj\u00e4rvi",
        "J Peltola",
        "I Korhonen"
      ],
      "year": 2006
    },
    {
      "title": "Implementation of a real-time human movement classifier using a triaxial accelerometer for ambulatory monitoring",
      "authors": [
        "D Karantonis",
        "M Narayanan",
        "M Mathie",
        "N Lovell",
        "B Celler"
      ],
      "year": 2006,
      "doi": "10.1109/titb.2005.856864"
    },
    {
      "title": "The technology boom: A new era in obesity management",
      "authors": [
        "L Gilmore",
        "A Duh\u00e9",
        "E Frost",
        "L Redman"
      ],
      "year": 2014
    },
    {
      "title": "No longer wearing: investigating the abandonment of personal health-tracking technologies on craigslist",
      "authors": [
        "J Clawson",
        "J Pater",
        "A Miller",
        "E Mynatt",
        "L Mamykina"
      ],
      "year": 2015,
      "doi": "10.1145/2750858.2807554"
    },
    {
      "title": "Why we use and abandon smart devices",
      "authors": [
        "A Lazar",
        "C Koehler",
        "J Tanenbaum",
        "D Nguyen"
      ],
      "year": 2015
    },
    {
      "title": "Why People Stick With or Abandon Wearable Devices",
      "authors": [
        "G Fox",
        "S Garland",
        "A Keibel",
        "L Saxon"
      ],
      "year": 2017
    },
    {
      "title": "Integrating population-based patterns with personal routine",
      "authors": [
        "C.-F Chung",
        "C Danis"
      ],
      "year": 2016,
      "doi": "10.4108/eai.16-5-2016.2263334"
    },
    {
      "title": "Randomized trial of a fitbit-based physical activity intervention for women",
      "authors": [
        "L Cadmus-Bertram",
        "B Marcus",
        "R Patterson",
        "B Parker",
        "B More"
      ],
      "year": 2015,
      "doi": "10.1016/j.amepre.2015.01.020"
    },
    {
      "title": "A meta-analysis of computertailored interventions for health behavior change",
      "authors": [
        "P Krebs",
        "P Prochaska",
        "J Rossi"
      ],
      "year": 2010,
      "doi": "10.1016/j.ypmed.2010.06.004"
    },
    {
      "title": "Places to walk: Convenience and regular physical activity",
      "authors": [
        "K Powell",
        "L Martin",
        "P Chowdhury"
      ],
      "year": 2003,
      "doi": "10.2105/ajph.93.9.1519"
    },
    {
      "title": "Using pedometers to increase physical activity and improve health: A systematic review",
      "authors": [
        "D Bravata"
      ],
      "year": 2007,
      "doi": "10.1001/jama.298.19.2296"
    },
    {
      "title": "An adaptive physical activity intervention for overweight Adults: A randomized controlled trial",
      "authors": [
        "M Adams",
        "J Sallis",
        "G Norman",
        "M Hovell",
        "E Hekler",
        "E Perata"
      ],
      "year": 2013
    },
    {
      "title": "Effectiveness of an activity tracker-and internet-based adaptive walking program for adults: A randomized controlled trial",
      "authors": [
        "J Poirier"
      ],
      "year": 2016
    },
    {
      "title": "Evaluating machine learning-based automated personalized daily step goals delivered through a mobile phone app: Randomized controlled trial",
      "authors": [
        "M Zhou"
      ],
      "year": 2018,
      "doi": "10.2196/mhealth.9117"
    },
    {
      "title": "A novel approach for fully automated, personalized health coaching for adults with prediabetes: pilot clinical trial",
      "authors": [
        "E Everett",
        "B Kane",
        "A Yoo",
        "A Dobs",
        "N Mathioudakis"
      ],
      "year": 2018,
      "doi": "10.2196/jmir.9723"
    },
    {
      "title": "Personalized physical activity coaching: A machine learning approach",
      "authors": [
        "T Dijkhuis",
        "F Blaauw",
        "M Van Ittersum",
        "H Velthuijsen",
        "M Aiello"
      ],
      "year": 2018,
      "doi": "10.3390/s18020623"
    },
    {
      "title": "Automated personalized feedback for physical activity and dietary behavior change with mobile Phones: A randomized controlled trial on adults",
      "authors": [
        "M Rabbi",
        "A Pfammatter",
        "M Zhang",
        "B Spring",
        "T Choudhury"
      ],
      "year": 2015,
      "doi": "10.2196/mhealth.4160"
    },
    {
      "title": "The behaviour change wheel: A new method for characterising and designing behaviour change interventions",
      "authors": [
        "S Michie",
        "M Van Stralen",
        "R West"
      ],
      "year": 2011
    },
    {
      "title": "A personalized pacing system for real-time physical activity advising",
      "authors": [
        "H Chang"
      ],
      "year": 2017,
      "doi": "10.1109/chase.2017.95"
    },
    {
      "title": "Should You Really Take 10,000",
      "year": 2016,
      "doi": "10.64628/ab.ua5csw97k"
    },
    {
      "title": "Linear Optimal Control: H(2) and H (Infinity) Methods",
      "authors": [
        "J Burl"
      ],
      "year": 1998
    },
    {
      "title": "Survey of clustering algorithms",
      "authors": [
        "R Xu",
        "D Wunsch"
      ],
      "year": 2005
    },
    {
      "title": "On clustering validation techniques",
      "authors": [
        "M Halkidi",
        "Y Batistakis",
        "M Vazirgiannis"
      ],
      "year": 2001,
      "doi": "10.1023/a:1012801612483"
    },
    {
      "title": "Random Forests",
      "authors": [
        "L Breiman",
        "A Cutler"
      ],
      "doi": "10.32614/cran.package.randomforest"
    },
    {
      "title": "Generalized Additive Models (Chapman & Hall/CRC Monographs on Statistics & Applied Probability",
      "authors": [
        "T Hastie",
        "R Tibshirani"
      ],
      "year": 1990,
      "doi": "10.1201/crcappenvsta"
    },
    {
      "title": "Time and frequency domain analysis of spike train and time series data",
      "authors": [
        "D Halliday",
        "J Rosenberg"
      ],
      "year": 1999,
      "doi": "10.1007/978-3-642-58552-4_18"
    },
    {
      "title": "How many steps/day are enough?",
      "authors": [
        "C Tudor-Locke",
        "D Bassett"
      ],
      "year": 2004
    },
    {
      "title": "Clustering methods",
      "authors": [
        "L Rokach",
        "O Maimon"
      ],
      "year": 2005,
      "doi": "10.1007/0-387-25465-x_15"
    },
    {
      "title": "Hierarchical grouping to optimize an objective function",
      "authors": [
        "J Ward"
      ],
      "year": 1963,
      "doi": "10.1080/01621459.1963.10500845"
    },
    {
      "title": "Using the student's t-test with extremely small sample sizes",
      "authors": [
        "J Winter"
      ],
      "year": 2013,
      "doi": "10.1016/j.aap.2012.07.003"
    },
    {
      "title": "K-means-: A unified approach to clustering and outlier detection",
      "authors": [
        "S Chawla",
        "A Gionis"
      ],
      "year": 2013
    },
    {
      "title": "Efficacy of smart loss, a smartphone-based weight loss intervention: Results from a randomized controlled trial",
      "authors": [
        "C Martin",
        "A Miller",
        "D Thomas",
        "C Champagne",
        "H Han",
        "T Church"
      ],
      "year": 2015
    },
    {
      "title": "Personalization revisited: A reflective approach helps people better personalize health services and motivates them to increase physical activity",
      "authors": [
        "M Lee",
        "J Kim",
        "J Forlizzi",
        "S Kiesler"
      ],
      "year": 2015
    },
    {
      "title": "Adaptive concept drift detection",
      "authors": [
        "A Dries",
        "U R\u00fcckert"
      ],
      "year": 2009
    },
    {
      "title": "Technology-based innovations to foster personalized healthy lifestyles and well-being: A targeted review",
      "authors": [
        "E Spanakis"
      ],
      "year": 2016,
      "doi": "10.2196/jmir.4863"
    }
  ],
  "num_references": 41
}
